<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="uwot">
<title>Leopold: Lightweight Estimate of Preservation of Local Density • uwot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Leopold: Lightweight Estimate of Preservation of Local Density">
<meta property="og:description" content="uwot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">uwot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.16.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/uwot.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jlmelville/uwot/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Leopold: Lightweight Estimate of Preservation of Local Density</h1>
            <h3 data-toc-skip class="subtitle">Approximating
densMAP</h3>
            
            <h4 data-toc-skip class="date">February 16 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jlmelville/uwot/blob/HEAD/vignettes/articles/leopold.Rmd" class="external-link"><code>vignettes/articles/leopold.Rmd</code></a></small>
      <div class="d-none name"><code>leopold.Rmd</code></div>
    </div>

    
    
<p>This is part of the documentation of <a href="https://github.com/jlmelville/uwot" class="external-link">uwot</a>.</p>
<div class="section level2">
<h2 id="densmap">densMAP<a class="anchor" aria-label="anchor" href="#densmap"></a>
</h2>
<p><a href="https://doi.org/10.1038/s41587-020-00801-7" class="external-link">densMAP</a> is a
variation on UMAP that attempts to preserve the differences in density
in the original data by adding a new component to the cost function. It
is available in the Python UMAP implementation by setting
<code>densmap=True</code>. See also <a href="https://umap-learn.readthedocs.io/en/latest/densmap_demo.htm" class="external-link">this
excellent tutorial</a>. There has been a <a href="https://github.com/jlmelville/uwot/issues/73" class="external-link">request to add
densMAP to uwot</a> since the start of 2021. This document describes the
approximate version of densMAP that is available in <code>uwot</code>
which may be good enough. But first, a bit more about densMAP.</p>
<p>densMAP can be seen as adding a regularization to the UMAP cost
function in which the “local radius” of each observation in the input
and output space is calculated and the Pearson correlation between the
two is optimized.</p>
<p>The radius of observation <span class="math inline">\(i\)</span>,
<span class="math inline">\(R_i\)</span> is calculated as:</p>
<p><span class="math display">\[
R_i = \frac{1}{\sum_i P_{ij}} \sum_i d_{ij}^2 P_{ij}
\]</span></p>
<p>where <span class="math inline">\(d_{ij}\)</span> is the distance
between point <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> and <span class="math inline">\(P_{ij}\)</span> is the <em>symmetrized</em> edge
weight between <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, i.e. the radius is the edge-weighted
average of the squared distances between each <span class="math inline">\(i\)</span> and each of its neighbors. Because the
matrix has been symmetrized, <span class="math inline">\(i\)</span> may
have a different number of neighbors than the <code>n_neighbors</code>
parameter that the user specifies.</p>
<p>To get a feel for what densMAP does, below are some results from the
Python UMAP (i.e. no <code>uwot</code> output here), with and without
<code>densmap=True</code>. As recommended by the current UMAP README, I
also set <code>n_neighbors=30</code>, except for
<code>subset_clusters</code>, which I’ll explain when I get to it.
Everything else was left as the defaults.</p>
<p>The images below are:</p>
<ul>
<li>Top left: the UMAP results colored by the typical label for that
dataset. There are some cryptic numbers in the subtitle which you should
feel free to ignore.</li>
<li>Top right: UMAP results with each point colored by the log of the
input local radius, using the <a href="https://colorbrewer2.org/#type=diverging&amp;scheme=Spectral&amp;n=11" class="external-link">ColorBrewer
Spectral palette</a>. Red means a small radius, blue means a large
radius. This should show areas that densMAP is likely to contract or
expand, respectively.</li>
<li>Middle left: the densMAP results colored by the typical label for
that dataset.</li>
<li>Middle right: the densMAP results colored by local radius.</li>
<li>Bottom: a plot of the log of the input local radii vs the log output
radii and the Pearson correlation between them. These radii are returned
from the <code>fit_transform</code> method when
<code>densmap=True</code>. When there were more than 1000 points, I used
<code>smoothScatter</code> to plot the results.</li>
</ul>
<p>First two datasets are simple simulation sets based on <a href="https://distill.pub/2016/misread-tsne/" class="external-link">How to Use t-SNE
Effectively</a>, specifically sections 2 (“Cluster sizes in a t-SNE plot
mean nothing”) and 6 (“For topology, you may need more than one
plot”).</p>
<div class="section level3">
<h3 id="two_different_clusters">two_different_clusters<a class="anchor" aria-label="anchor" href="#two_different_clusters"></a>
</h3>
<p>This dataset consists of two 50D Gaussians of 5,000 points each. One
of the clusters has a standard deviation 10x the other. I used <a href="https://github.com/jlmelville/snedata" class="external-link">snedata</a> to generate
this data (via the <code>two_different_clusters_data</code>
function).</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/two_different_clusters-umap.png" alt="two_different_clusters umap"></td>
<td align="center"><img src="img/leopold/umap/two_different_clusters-ro.png" alt="two_different_clusters ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/two_different_clusters-densmap.png" alt="two_different_clusters densmap"></td>
<td align="center"><img src="img/leopold/umap/two_different_clusters-densmap-ro.png" alt="two_different_clusters densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/two_different_clusters-cor.png" alt="two_different_clusters cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>Like t-SNE, default UMAP shows both of these clusters as the same
size. densMAP shows one of the clusters as smaller. A good start.</p>
</div>
<div class="section level3">
<h3 id="subset_clusters">subset_clusters<a class="anchor" aria-label="anchor" href="#subset_clusters"></a>
</h3>
<p>This dataset once again features two 50D gaussians of 5,000 points
each, but this time they overlap entirely. The larger cluster has a
standard deviation of 50, the smaller a standard deviation of 1.</p>
<p>For this dataset I used <code>n_neighbors=150</code>, much larger
than the <code>n_neighbors=30</code> setting used for the other plots.
This was to be consistent with the plots I generated with
<code>uwot</code>. With <code>uwot</code> I precalculated exact nearest
neighbors for all datasets and for this dataset, using the exact 30
nearest neighbors results in the smaller cluster being embedded at the
edge of the larger cluster. Presumably 30 nearest neighbors doesn’t
result in enough edges between the two clusters to properly situate the
smaller cluster. The approximate nearest neighbors routine used in UMAP
results in edges between sufficiently far away neighbors to create a
neighborhood to that reflects the global structure better. I didn’t
investigate this thoroughly, but it sounds plausible to me.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/subset_clusters-umap.png" alt="subset_clusters umap"></td>
<td align="center"><img src="img/leopold/umap/subset_clusters-ro.png" alt="subset_clusters ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/subset_clusters-densmap.png" alt="subset_clusters densmap"></td>
<td align="center"><img src="img/leopold/umap/subset_clusters-densmap-ro.png" alt="subset_clusters densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/subset_clusters-cor.png" alt="subset_clusters cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>UMAP considers these two clusters to be the same size. With densMAP,
the ring-shaped structure that is found with high perplexities with
t-SNE shows up. But at least the small cluster is inside the big one.
Note that if you re-run this with <code>n_neighbors=30</code> the
results are not noticeably changed.</p>
</div>
<div class="section level3">
<h3 id="s1k">s1k<a class="anchor" aria-label="anchor" href="#s1k"></a>
</h3>
<p>This is a synthetic dataset I like to use: 1000 points from a fuzzy
10D simplex.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/s1k-umap.png" alt="s1k umap"></td>
<td align="center"><img src="img/leopold/umap/s1k-ro.png" alt="s1k ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/s1k-densmap.png" alt="s1k densmap"></td>
<td align="center"><img src="img/leopold/umap/s1k-densmap-ro.png" alt="s1k densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/s1k-cor.png" alt="s1k cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>I can’t say I like what densMAP has done here. There is one point
that has been flung far away from the rest of the plot. You can see from
the coloring that this is because it has a large local radius. This
perhaps indicates that the local radius calculation can be affected by
edge effects.</p>
</div>
<div class="section level3">
<h3 id="swissroll">swissroll<a class="anchor" aria-label="anchor" href="#swissroll"></a>
</h3>
<p>A swiss roll dataset <a href="https://github.com/jlmelville/snedata" class="external-link">of my own devising</a>.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/swissroll-umap.png" alt="swissroll umap"></td>
<td align="center"><img src="img/leopold/umap/swissroll-ro.png" alt="swissroll ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/swissroll-densmap.png" alt="swissroll densmap"></td>
<td align="center"><img src="img/leopold/umap/swissroll-densmap-ro.png" alt="swissroll densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/swissroll-cor.png" alt="swissroll cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>densMAP does a noticeably better job at not ripping the swiss roll
than UMAP does. As you would expect the local density to be fairly
uniform across a 2D manifold I don’t know if there’s an <em>a
priori</em> reason to have thought densMAP would do a better job
here.</p>
</div>
<div class="section level3">
<h3 id="scurvehole">scurvehole<a class="anchor" aria-label="anchor" href="#scurvehole"></a>
</h3>
<p>A 3D S-curve with a hole data set, used to validate the <a href="https://arxiv.org/abs/2012.04456" class="external-link">PaCMAP method</a> (see also the
<a href="https://github.com/YingfanWang/PaCMAP" class="external-link">github repo</a>).</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/scurvehole-umap.png" alt="scurvehole umap"></td>
<td align="center"><img src="img/leopold/umap/scurvehole-ro.png" alt="scurvehole ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/scurvehole-densmap.png" alt="scurvehole densmap"></td>
<td align="center"><img src="img/leopold/umap/scurvehole-densmap-ro.png" alt="scurvehole densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/scurvehole-cor.png" alt="scurvehole cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="iris">iris<a class="anchor" aria-label="anchor" href="#iris"></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/Iris_flower_data_set" class="external-link">Ronald
Fisher’s iris dataset</a>.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/iris-umap.png" alt="iris umap"></td>
<td align="center"><img src="img/leopold/umap/iris-ro.png" alt="iris ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/iris-densmap.png" alt="iris densmap"></td>
<td align="center"><img src="img/leopold/umap/iris-densmap-ro.png" alt="iris densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/iris-cor.png" alt="iris cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="spenguins">spenguins<a class="anchor" aria-label="anchor" href="#spenguins"></a>
</h3>
<p>The <a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">Palmer
Penguins</a>. The <code>s</code> in <code>spenguins</code> stands for
scaled, because I filtered out entries with missing values then Z-scaled
the inputs.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/spenguins-umap.png" alt="spenguins umap"></td>
<td align="center"><img src="img/leopold/umap/spenguins-ro.png" alt="spenguins ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/spenguins-densmap.png" alt="spenguins densmap"></td>
<td align="center"><img src="img/leopold/umap/spenguins-densmap-ro.png" alt="spenguins densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/spenguins-cor.png" alt="spenguins cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="mammoth">mammoth<a class="anchor" aria-label="anchor" href="#mammoth"></a>
</h3>
<p>A 3D point cloud of a <a href="https://3d.si.edu/object/3d/mammuthus-primigenius-blumbach:341c96cd-f967-4540-8ed1-d3fc56d31f12" class="external-link">mammoth
at the Smithsonian</a>, from <a href="https://pair-code.github.io/understanding-umap/" class="external-link">Understanding
UMAP</a>, based on work originally done by <a href="https://github.com/MNoichl/UMAP-examples-mammoth-" class="external-link">Max
Noichl</a>.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/mammoth-umap.png" alt="mammoth umap"></td>
<td align="center"><img src="img/leopold/umap/mammoth-ro.png" alt="mammoth ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/mammoth-densmap.png" alt="mammoth densmap"></td>
<td align="center"><img src="img/leopold/umap/mammoth-densmap-ro.png" alt="mammoth densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/mammoth-cor.png" alt="mammoth cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="oli">oli<a class="anchor" aria-label="anchor" href="#oli"></a>
</h3>
<p>The <a href="https://cs.nyu.edu/~roweis/data.html" class="external-link">Olivetti Faces</a>
images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/oli-umap.png" alt="oli umap"></td>
<td align="center"><img src="img/leopold/umap/oli-ro.png" alt="oli ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/oli-densmap.png" alt="oli densmap"></td>
<td align="center"><img src="img/leopold/umap/oli-densmap-ro.png" alt="oli densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/oli-cor.png" alt="oli cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="frey">frey<a class="anchor" aria-label="anchor" href="#frey"></a>
</h3>
<p>The <a href="https://cs.nyu.edu/~roweis/data.html" class="external-link">Frey Faces</a>
images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/frey-umap.png" alt="frey umap"></td>
<td align="center"><img src="img/leopold/umap/frey-ro.png" alt="frey ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/frey-densmap.png" alt="frey densmap"></td>
<td align="center"><img src="img/leopold/umap/frey-densmap-ro.png" alt="frey densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/frey-cor.png" alt="frey cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="isofaces">isofaces<a class="anchor" aria-label="anchor" href="#isofaces"></a>
</h3>
<p>The faces dataset used in Isomap (processed via <a href="https://gist.github.com/jlmelville/339dfeb80c3e836e887d70a37679b244" class="external-link">this
gist</a>).</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/isofaces-umap.png" alt="isofaces umap"></td>
<td align="center"><img src="img/leopold/umap/isofaces-ro.png" alt="isofaces ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/isofaces-densmap.png" alt="isofaces densmap"></td>
<td align="center"><img src="img/leopold/umap/isofaces-densmap-ro.png" alt="isofaces densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/isofaces-cor.png" alt="isofaces cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="mnist">mnist<a class="anchor" aria-label="anchor" href="#mnist"></a>
</h3>
<p>The <a href="http://yann.lecun.com/exdb/mnist/" class="external-link">MNIST digits</a>
images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/mnist-umap.png" alt="mnist umap"></td>
<td align="center"><img src="img/leopold/umap/mnist-ro.png" alt="mnist ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/mnist-densmap.png" alt="mnist densmap"></td>
<td align="center"><img src="img/leopold/umap/mnist-densmap-ro.png" alt="mnist densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/mnist-cor.png" alt="mnist cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>The orange cluster is the 1 digits and its smaller radius is
exceptionally obvious when coloring the UMAP plot by radius. It very
noticeably shrinks when densMAP goes to work on it.</p>
</div>
<div class="section level3">
<h3 id="fashion">fashion<a class="anchor" aria-label="anchor" href="#fashion"></a>
</h3>
<p>The <a href="https://github.com/zalandoresearch/fashion-mnist" class="external-link">Fashion
MNIST</a> images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/fashion-umap.png" alt="fashion umap"></td>
<td align="center"><img src="img/leopold/umap/fashion-ro.png" alt="fashion ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/fashion-densmap.png" alt="fashion densmap"></td>
<td align="center"><img src="img/leopold/umap/fashion-densmap-ro.png" alt="fashion densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/fashion-cor.png" alt="fashion cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>Similarly to the MNIST digits, the orange cluster (this time its
images of pants) is noticeably smaller than the other clusters.</p>
</div>
<div class="section level3">
<h3 id="kuzushiji">kuzushiji<a class="anchor" aria-label="anchor" href="#kuzushiji"></a>
</h3>
<p>The <a href="http://codh.rois.ac.jp/kmnist/index.html.en" class="external-link">Kuzushiji
MNIST</a> images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/kuzushiji-umap.png" alt="kuzushiji umap"></td>
<td align="center"><img src="img/leopold/umap/kuzushiji-ro.png" alt="kuzushiji ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/kuzushiji-densmap.png" alt="kuzushiji densmap"></td>
<td align="center"><img src="img/leopold/umap/kuzushiji-densmap-ro.png" alt="kuzushiji densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/kuzushiji-cor.png" alt="kuzushiji cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="norb">norb<a class="anchor" aria-label="anchor" href="#norb"></a>
</h3>
<p>The <a href="https://cs.nyu.edu/~ylclab/data/norb-v1.0-small/" class="external-link">Small
NORB</a> images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/norb-umap.png" alt="norb umap"></td>
<td align="center"><img src="img/leopold/umap/norb-ro.png" alt="norb ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/norb-densmap.png" alt="norb densmap"></td>
<td align="center"><img src="img/leopold/umap/norb-densmap-ro.png" alt="norb densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/norb-cor.png" alt="norb cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>You can see the largest of the blue/purple ring-like structures is
broken up by UMAP, but densMAP preserves it. In fact, the densMAP plot
is one of the nicer UMAP layouts of the small NORB datasets I’ve
seen.</p>
</div>
<div class="section level3">
<h3 id="coil20">coil20<a class="anchor" aria-label="anchor" href="#coil20"></a>
</h3>
<p>The <a href="https://www.cs.columbia.edu/CAVE/software/softlib/coil-20.php" class="external-link">COIL-20</a>
images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/coil20-umap.png" alt="coil20 umap"></td>
<td align="center"><img src="img/leopold/umap/coil20-ro.png" alt="coil20 ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/coil20-densmap.png" alt="coil20 densmap"></td>
<td align="center"><img src="img/leopold/umap/coil20-densmap-ro.png" alt="coil20 densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/coil20-cor.png" alt="coil20 cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="coil100">coil100<a class="anchor" aria-label="anchor" href="#coil100"></a>
</h3>
<p>The <a href="https://www.cs.columbia.edu/CAVE/software/softlib/coil-100.php" class="external-link">COIL-100</a>
images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/coil100-umap.png" alt="coil100 umap"></td>
<td align="center"><img src="img/leopold/umap/coil100-ro.png" alt="coil100 ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/coil100-densmap.png" alt="coil100 densmap"></td>
<td align="center"><img src="img/leopold/umap/coil100-densmap-ro.png" alt="coil100 densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/coil100-cor.png" alt="coil100 cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="cifar10">cifar10<a class="anchor" aria-label="anchor" href="#cifar10"></a>
</h3>
<p>The <a href="https://www.cs.toronto.edu/~kriz/cifar.html" class="external-link">CIFAR-10</a>
images.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/cifar10-umap.png" alt="cifar10 umap"></td>
<td align="center"><img src="img/leopold/umap/cifar10-ro.png" alt="cifar10 ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/cifar10-densmap.png" alt="cifar10 densmap"></td>
<td align="center"><img src="img/leopold/umap/cifar10-densmap-ro.png" alt="cifar10 densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/cifar10-cor.png" alt="cifar10 cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="macosko2015">macosko2015<a class="anchor" aria-label="anchor" href="#macosko2015"></a>
</h3>
<p>The <a href="https://doi.org/10.1016/j.cell.2015.05.002" class="external-link">macosko2015</a> RNAseq
data.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/macosko2015-umap.png" alt="macosko2015 umap"></td>
<td align="center"><img src="img/leopold/umap/macosko2015-ro.png" alt="macosko2015 ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/macosko2015-densmap.png" alt="macosko2015 densmap"></td>
<td align="center"><img src="img/leopold/umap/macosko2015-densmap-ro.png" alt="macosko2015 densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/macosko2015-cor.png" alt="macosko2015 cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>This dataset (an RNA sequence dataset) isn’t a lot of fun to
visualize with vanilla UMAP, but densMAP does not improve matters.</p>
</div>
<div class="section level3">
<h3 id="tasic2018">tasic2018<a class="anchor" aria-label="anchor" href="#tasic2018"></a>
</h3>
<p>RNAseq data from the <a href="http://celltypes.brain-map.org/rnaseq/mouse" class="external-link">Allen Brain Atlas</a>
originally reported by <a href="http://dx.doi.org/10.1038/s41586-018-0654-5" class="external-link">Tasic and
co-workers</a>.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/tasic2018-umap.png" alt="tasic2018 umap"></td>
<td align="center"><img src="img/leopold/umap/tasic2018-ro.png" alt="tasic2018 ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/tasic2018-densmap.png" alt="tasic2018 densmap"></td>
<td align="center"><img src="img/leopold/umap/tasic2018-densmap-ro.png" alt="tasic2018 densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/tasic2018-cor.png" alt="tasic2018 cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>Another RNAseq dataset, densMAP has a very interesting effect on the
cluster sizes, but because some of the clusters have a very low density,
this has the effect of squashing the other into the center of the
plot.</p>
</div>
<div class="section level3">
<h3 id="lamanno2020">lamanno2020<a class="anchor" aria-label="anchor" href="#lamanno2020"></a>
</h3>
<p>Another RNASeq data, found via the <a href="https://github.com/pachterlab/picasso/blob/main/examplePicasso.ipynb" class="external-link">Picasso
example notebook</a>. I think the publication reference is <a href="https://doi.org/10.1038/s41586-021-03775-x" class="external-link uri">https://doi.org/10.1038/s41586-021-03775-x</a> (was
published at <a href="https://www.biorxiv.org/content/10.1101/2020.07.02.184051v1" class="external-link">biorXiv</a>
in 2020).</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/lamanno2020-umap.png" alt="lamanno2020 umap"></td>
<td align="center"><img src="img/leopold/umap/lamanno2020-ro.png" alt="lamanno2020 ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/lamanno2020-densmap.png" alt="lamanno2020 densmap"></td>
<td align="center"><img src="img/leopold/umap/lamanno2020-densmap-ro.png" alt="lamanno2020 densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/lamanno2020-cor.png" alt="lamanno2020 cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="ng20">ng20<a class="anchor" aria-label="anchor" href="#ng20"></a>
</h3>
<p>The <a href="http://qwone.com/~jason/20Newsgroups/" class="external-link">20 Newsgroups</a>
dataset, which I manually converted into a dense 3000D PCA result: <a href="https://gist.github.com/jlmelville/78f5dc241c9163494eda509a1c5f46e8" class="external-link">see
this gist</a>.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/ng20-umap.png" alt="ng20 umap"></td>
<td align="center"><img src="img/leopold/umap/ng20-ro.png" alt="ng20 ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/umap/ng20-densmap.png" alt="ng20 densmap"></td>
<td align="center"><img src="img/leopold/umap/ng20-densmap-ro.png" alt="ng20 densmap-ro"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/leopold/umap/ng20-cor.png" alt="ng20 cor"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p>densMAP noticeably has a hard time mapping the local radii to the 2D
output.</p>
<p>What I take away from all this:</p>
<ul>
<li>densMAP does a good job at maintaining the correlation of input and
output radii. The only time it fails is with the 20 Newsgroups
dataset.</li>
<li>A good correlation doesn’t necessarily mean a helpful static
visualization. Some of the results have some clusters which are highly
dispersed which may reflect the true relationship of densities but makes
it hard to actually see the cluster, and the rest of the data gets
crushed into the middle of the plot. That’s not necessarily a problem if
you have an interactive plot and can pan and zoom. Or you can change the
regularization value of <code>dens_lambda</code>. I didn’t try that but
I have no reason to doubt a satisfying value can be found for any of the
datasets where I didn’t like the output with default settings.</li>
</ul>
<p>But I don’t currently want to implement densMAP because it involves
adding lots of extra code, much of it in C++ and I am very lazy.</p>
</div>
</div>
<div class="section level2">
<h2 id="approximating-densmap">Approximating densMAP<a class="anchor" aria-label="anchor" href="#approximating-densmap"></a>
</h2>
<p>Here’s my pitch for an approximation to densMAP, which I have named
the Lightweight Estimate of Preservation of Local Density (Leopold).</p>
<p>For the input radii, as part of the smooth k-nearest neighbor
distances routine we already calculate <span class="math inline">\(\rho\)</span> which is the distance to the nearest
neighbor of each item in the dataset (subject to the
<code>local_connectivity</code> constraint). Additionally, we also
calculate <span class="math inline">\(\sigma\)</span> which is a
normalization factor used with the neighbors at distance greater than
<span class="math inline">\(\rho\)</span>. It must have units of
distance, and the larger the distances to the neighbors, the larger
<span class="math inline">\(\sigma\)</span> gets. So I propose the
following definition for the local radius:</p>
<p><span class="math display">\[
R_i = \rho + \sigma
\]</span></p>
<p>The biggest difference between this definition of the local input
radii is that I haven’t bothered to square the distances (it doesn’t
make much difference for leopold) and that the values for <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\rho\)</span> are calculated <em>before</em> the
symmetrization of the UMAP input edge weights. So these values are
missing the influence of observations outside the initial k-nearest
neighborhood graph.</p>
<p>For the output radii, I know from looking at the <a href="https://jlmelville.github.io/uwot/articles/umap-examples.html">output
weight function parameters</a>, that increasing the <code>a</code>
parameter makes the clusters in a UMAP plot shrink, and vice versa. So
let’s use that as measure of the output density, i.e. the inverse of the
local radius. As every point has its own radius, the value for a given
weight between points <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> will be the geometric mean of the two
radii:</p>
<p><span class="math display">\[
w_{ij} = 1 / \left(1 + \frac{d_{ij}^2}{\sqrt{r_i r_j}} \right)
\]</span></p>
<p>where <span class="math inline">\(r_i\)</span> is a scaled version of
the input radius <span class="math inline">\(R_i\)</span> suitable for
the lower dimensional space. This is a similar sort of scaling to that
used by <a href="https://papers.nips.cc/paper/2004/hash/40173ea48d9567f1f393b20c855bb40b-Abstract.html" class="external-link">Zelnik-Manor
and Perona</a> for “self-tuning” spectral clustering, and also
recommended for local scaling to reduce hubness in high dimensional
space by <a href="https://www.jmlr.org/papers/v13/schnitzer12a.html" class="external-link">Schnitzer and
co-workers</a>.</p>
<p>The scaling from input to output space is not sophisticated: I have
observed that for typical values of <span class="math inline">\(b\)</span> used in UMAP, a usable range of <span class="math inline">\(a\)</span> values are between 0.01 (very diffuse
clusters) and 100 (very tight clusters), so we will just map the inverse
of the input local radii to that range.</p>
<p>The final adjustment to this is that it would be good to introduce a
parameter that controls how much of the range of <code>a</code> is used
in the output and thus how big a disparity of the input radii is
reflected in the output. To that end, there is an adjustable parameter
for leopold: a <code>dens_scale</code> parameter. Set it to 1 and it
uses all the available range of <code>a</code>. Set it to 0 and you get
plain old UMAP back, with a fixed global value of <code>a</code> as
specified by the user (or via the <code>spread</code> and
<code>min_dist</code> parameters). Intermediate values get intermediate
results.</p>
<p>In my mind this scaling of the radii is straightforward, but looking
up at that description maybe it’s not. The procedure is:</p>
<ol style="list-style-type: decimal">
<li>Define the minimum log density as <span class="math inline">\(a
\times 10^{-2s}\)</span> where <span class="math inline">\(a\)</span> is
the UMAP <code>a</code> parameter for the output and <span class="math inline">\(s\)</span> is the <code>den_scale</code>
parameter.</li>
<li>Define the maximum log density as <span class="math inline">\(a
\times 10^{2s}\)</span>.</li>
<li>Range scale <span class="math inline">\(\log \left(1 / R_i
\right)\)</span> between the minimum and maximum log density. Call that
range scaled log density <span class="math inline">\(\Delta_i\)</span>
</li>
<li>
<span class="math inline">\(a_i = \sqrt{ \exp \left( \Delta_i
\right) }\)</span>.</li>
<li>The leopold output weight function is <span class="math inline">\(w_{ij} = 1 / \left( 1 + a_i a_j d_{ij}^2
\right)\)</span>.</li>
</ol>
<div class="section level3">
<h3 id="the-advantage-of-leopold">The Advantage of leopold<a class="anchor" aria-label="anchor" href="#the-advantage-of-leopold"></a>
</h3>
<p>The main advantage is for me: to implement this I don’t have to write
much new code: <span class="math inline">\(\rho\)</span> and <span class="math inline">\(\sigma\)</span> are already calculated and
implementing the per-observation value for <code>a</code> in the output
function requires creating a new version of the umap gradient routine
that expects a vector of values rather than a scalar. This is a lot less
work than implementing densMAP.</p>
</div>
<div class="section level3">
<h3 id="the-disadvantage-of-leopold">The Disadvantage of leopold<a class="anchor" aria-label="anchor" href="#the-disadvantage-of-leopold"></a>
</h3>
<p>It’s all a bit approximate. But all I really want from this technique
is that it makes the dense clusters get smaller and the diffuse clusters
get bigger. The exact changes seem less important to me as long as they
are vaguely sensible. I don’t claim to have a good sense of what I
expect to see when a blob of data with an intrinsic dimensionality of
<span class="math inline">\(d\)</span> and a radius of <span class="math inline">\(r\)</span> is embedded into 2D versus one with an
intrinsic dimensionality of <span class="math inline">\(d + 5\)</span>
but a radius of <span class="math inline">\(r / 2\)</span>. Even if that
was accurately embedded, would it even look sensible let alone
helpful?</p>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>Here are some plots using leopold. I used exact nearest neighbors for
these results as nearest neighbor calculations are usually the slowest
part of UMAP. The following deviations from default parameters were
used: <code>min_dist = 0.1</code> to be closer to the Python UMAP
results. For consistency with densMAP, <code>n_neighbors = 30</code>
except for <code>subset_clusters</code> which uses
<code>n_neighbors = 150</code>. Also to be consistent with densMAP, an
extra 200 epochs on top of the usual default <code>n_epochs</code> was
used.</p>
<p>In the plots below:</p>
<p>top left: the output of running leopold,</p>
<ul>
<li>Top left: the leopold results colored by the typical label for that
dataset.</li>
<li>Top right: UMAP results with each point colored by the log of the
input local radius, using the <a href="https://colorbrewer2.org/#type=diverging&amp;scheme=Spectral&amp;n=11" class="external-link">ColorBrewer
Spectral palette</a>. Red means a small radius, blue means a large
radius. This should show areas that densMAP is likely to contract or
expand, respectively.</li>
<li>Bottom left: a plot of the log of the input local radii vs the log
output radii and the Pearson correlation between them. When there were
more than 1000 points, I used <code>smoothScatter</code> to plot the
results.</li>
<li>Bottom right: a plot of the log of the densmap input local radii
against the leopold equivalent (<span class="math inline">\(\rho +
\sigma\)</span>). The number in the title is Pearson correlation.
There’s no particular reason for the two measures of local radius to be
the same, but they should show a similar trend.</li>
</ul>
<p>For a lot of these datasets, I won’t have anything to say unless
there is an interesting contrast or similarity with densMAP.</p>
<div class="section level3">
<h3 id="two_different_clusters-1">two_different_clusters<a class="anchor" aria-label="anchor" href="#two_different_clusters-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/two_different_clusters-leopold.png" alt="two_different_clusters leopold"></td>
<td align="center"><img src="img/leopold/leopold/two_different_clusters-leopold-ro.png" alt="two_different_clusters leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/two_different_clusters-leopold-cor.png" alt="two_different_clusters leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/two_different_clusters-leopold-dro-cor.png" alt="two_different_clusters leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>leopold is able to produce two different sizes for the cluster,
although the size disparity is much larger than for densMAP. This is due
to the very bimodal nature of the standard deviations in this dataset.
One cluster gets one end of the radii scale (highly disperse) and the
second cluster gets the other (highly compact). Turning down
<code>dens_scale</code> to something like <code>0.2</code> works well
for this data set. But it doesn’t really matter as this is a very
artificial dataset. As long as the clusters are the right relative size
I am happy.</p>
</div>
<div class="section level3">
<h3 id="subset_clusters-1">subset_clusters<a class="anchor" aria-label="anchor" href="#subset_clusters-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/subset_clusters-leopold.png" alt="subset_clusters leopold"></td>
<td align="center"><img src="img/leopold/leopold/subset_clusters-leopold-ro.png" alt="subset_clusters leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/subset_clusters-leopold-cor.png" alt="subset_clusters leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/subset_clusters-leopold-dro-cor.png" alt="subset_clusters leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>This shows an interesting difference with densMAP: with densMAP, the
outer yellow ring had a more uniform density, whereas for leopold there
is a noticeable density gradient towards the center. I leave it up to
you to decide if that is a good or a bad thing.</p>
</div>
<div class="section level3">
<h3 id="s1k-1">s1k<a class="anchor" aria-label="anchor" href="#s1k-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/s1k-leopold.png" alt="s1k leopold"></td>
<td align="center"><img src="img/leopold/leopold/s1k-leopold-ro.png" alt="s1k leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/s1k-leopold-cor.png" alt="s1k leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/s1k-leopold-dro-cor.png" alt="s1k leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>The point that got pushed far away from the rest of the data in the
densMAP plot is not as far away with leopold.</p>
</div>
<div class="section level3">
<h3 id="swissroll-1">swissroll<a class="anchor" aria-label="anchor" href="#swissroll-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/swissroll-leopold.png" alt="swissroll leopold"></td>
<td align="center"><img src="img/leopold/leopold/swissroll-leopold-ro.png" alt="swissroll leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/swissroll-leopold-cor.png" alt="swissroll leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/swissroll-leopold-dro-cor.png" alt="swissroll leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>Both this one and <code>scurvehole</code> seem pretty comparable with
the densMAP results.</p>
</div>
<div class="section level3">
<h3 id="scurvehole-1">scurvehole<a class="anchor" aria-label="anchor" href="#scurvehole-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/scurvehole-leopold.png" alt="scurvehole leopold"></td>
<td align="center"><img src="img/leopold/leopold/scurvehole-leopold-ro.png" alt="scurvehole leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/scurvehole-leopold-cor.png" alt="scurvehole leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/scurvehole-leopold-dro-cor.png" alt="scurvehole leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="iris-1">iris<a class="anchor" aria-label="anchor" href="#iris-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/iris-leopold.png" alt="iris leopold"></td>
<td align="center"><img src="img/leopold/leopold/iris-leopold-ro.png" alt="iris leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/iris-leopold-cor.png" alt="iris leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/iris-leopold-dro-cor.png" alt="iris leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="spenguins-1">spenguins<a class="anchor" aria-label="anchor" href="#spenguins-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/spenguins-leopold.png" alt="spenguins leopold"></td>
<td align="center"><img src="img/leopold/leopold/spenguins-leopold-ro.png" alt="spenguins leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/spenguins-leopold-cor.png" alt="spenguins leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/spenguins-leopold-dro-cor.png" alt="spenguins leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="mammoth-1">mammoth<a class="anchor" aria-label="anchor" href="#mammoth-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/mammoth-leopold.png" alt="mammoth leopold"></td>
<td align="center"><img src="img/leopold/leopold/mammoth-leopold-ro.png" alt="mammoth leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/mammoth-leopold-cor.png" alt="mammoth leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/mammoth-leopold-dro-cor.png" alt="mammoth leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>If you compare this to densMAP, the extremities are much more diffuse
than with leopold.</p>
</div>
<div class="section level3">
<h3 id="oli-1">oli<a class="anchor" aria-label="anchor" href="#oli-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/oli-leopold.png" alt="oli leopold"></td>
<td align="center"><img src="img/leopold/leopold/oli-leopold-ro.png" alt="oli leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/oli-leopold-cor.png" alt="oli leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/oli-leopold-dro-cor.png" alt="oli leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="frey-1">frey<a class="anchor" aria-label="anchor" href="#frey-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/frey-leopold.png" alt="frey leopold"></td>
<td align="center"><img src="img/leopold/leopold/frey-leopold-ro.png" alt="frey leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/frey-leopold-cor.png" alt="frey leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/frey-leopold-dro-cor.png" alt="frey leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="isofaces-1">isofaces<a class="anchor" aria-label="anchor" href="#isofaces-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/isofaces-leopold.png" alt="isofaces leopold"></td>
<td align="center"><img src="img/leopold/leopold/isofaces-leopold-ro.png" alt="isofaces leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/isofaces-leopold-cor.png" alt="isofaces leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/isofaces-leopold-dro-cor.png" alt="isofaces leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="mnist-1">mnist<a class="anchor" aria-label="anchor" href="#mnist-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/mnist-leopold.png" alt="mnist leopold"></td>
<td align="center"><img src="img/leopold/leopold/mnist-leopold-ro.png" alt="mnist leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/mnist-leopold-cor.png" alt="mnist leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/mnist-leopold-dro-cor.png" alt="mnist leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>The main thing I hoped to see was the orange ‘1’ cluster shrink. And
it does. The yellow ‘2’ cluster has also noticeably grown. Changes are
more subtle for the other clusters, but apart from the ‘1’ cluster their
densities are all quite similar. I’m happy with this.</p>
</div>
<div class="section level3">
<h3 id="fashion-1">fashion<a class="anchor" aria-label="anchor" href="#fashion-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/fashion-leopold.png" alt="fashion leopold"></td>
<td align="center"><img src="img/leopold/leopold/fashion-leopold-ro.png" alt="fashion leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/fashion-leopold-cor.png" alt="fashion leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/fashion-leopold-dro-cor.png" alt="fashion leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>leopold behaves in a densMAP-like way here too by shrinking the
orange cluster. The clusters which densMAP expands are also larger here,
but are not as diffuse as densMAP makes them. I personally prefer the
leopold layout, but I am biased so you should probably just ignore
me.</p>
</div>
<div class="section level3">
<h3 id="kuzushiji-1">kuzushiji<a class="anchor" aria-label="anchor" href="#kuzushiji-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/kuzushiji-leopold.png" alt="kuzushiji leopold"></td>
<td align="center"><img src="img/leopold/leopold/kuzushiji-leopold-ro.png" alt="kuzushiji leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/kuzushiji-leopold-cor.png" alt="kuzushiji leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/kuzushiji-leopold-dro-cor.png" alt="kuzushiji leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="norb-1">norb<a class="anchor" aria-label="anchor" href="#norb-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/norb-leopold.png" alt="norb leopold"></td>
<td align="center"><img src="img/leopold/leopold/norb-leopold-ro.png" alt="norb leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/norb-leopold-cor.png" alt="norb leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/norb-leopold-dro-cor.png" alt="norb leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>This layout is fine, and maybe a bit neater than the UMAP one. But I
still like the densMAP version better.</p>
</div>
<div class="section level3">
<h3 id="coil20-1">coil20<a class="anchor" aria-label="anchor" href="#coil20-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/coil20-leopold.png" alt="coil20 leopold"></td>
<td align="center"><img src="img/leopold/leopold/coil20-leopold-ro.png" alt="coil20 leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/coil20-leopold-cor.png" alt="coil20 leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/coil20-leopold-dro-cor.png" alt="coil20 leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="coil100-1">coil100<a class="anchor" aria-label="anchor" href="#coil100-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/coil100-leopold.png" alt="coil100 leopold"></td>
<td align="center"><img src="img/leopold/leopold/coil100-leopold-ro.png" alt="coil100 leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/coil100-leopold-cor.png" alt="coil100 leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/coil100-leopold-dro-cor.png" alt="coil100 leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="cifar10-1">cifar10<a class="anchor" aria-label="anchor" href="#cifar10-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/cifar10-leopold.png" alt="cifar10 leopold"></td>
<td align="center"><img src="img/leopold/leopold/cifar10-leopold-ro.png" alt="cifar10 leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/cifar10-leopold-cor.png" alt="cifar10 leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/cifar10-leopold-dro-cor.png" alt="cifar10 leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="macosko2015-1">macosko2015<a class="anchor" aria-label="anchor" href="#macosko2015-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/macosko2015-leopold.png" alt="macosko2015 leopold"></td>
<td align="center"><img src="img/leopold/leopold/macosko2015-leopold-ro.png" alt="macosko2015 leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/macosko2015-leopold-cor.png" alt="macosko2015 leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/macosko2015-leopold-dro-cor.png" alt="macosko2015 leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>I think the layout that leopold provides is more legible than the
densMAP equivalent.</p>
</div>
<div class="section level3">
<h3 id="tasic2018-1">tasic2018<a class="anchor" aria-label="anchor" href="#tasic2018-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/tasic2018-leopold.png" alt="tasic2018 leopold"></td>
<td align="center"><img src="img/leopold/leopold/tasic2018-leopold-ro.png" alt="tasic2018 leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/tasic2018-leopold-cor.png" alt="tasic2018 leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/tasic2018-leopold-dro-cor.png" alt="tasic2018 leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>Another example where leopold produces a less compressed result,
because the more diffuse clusters (e.g. the clusters at the bottom of
the plot) are not as expanded.</p>
</div>
<div class="section level3">
<h3 id="lamanno2020-1">lamanno2020<a class="anchor" aria-label="anchor" href="#lamanno2020-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/lamanno2020-leopold.png" alt="lamanno2020 leopold"></td>
<td align="center"><img src="img/leopold/leopold/lamanno2020-leopold-ro.png" alt="lamanno2020 leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/lamanno2020-leopold-cor.png" alt="lamanno2020 leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/lamanno2020-leopold-dro-cor.png" alt="lamanno2020 leopold-dro-cor"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="ng20-1">ng20<a class="anchor" aria-label="anchor" href="#ng20-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/leopold/leopold/ng20-leopold.png" alt="ng20 leopold"></td>
<td align="center"><img src="img/leopold/leopold/ng20-leopold-ro.png" alt="ng20 leopold-ro"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/leopold/leopold/ng20-leopold-cor.png" alt="ng20 leopold-cor"></td>
<td align="center"><img src="img/leopold/leopold/ng20-leopold-dro-cor.png" alt="ng20 leopold-dro-cor"></td>
</tr>
</tbody>
</table>
<p>Does this layout look super-great? It does not. And nor can leopold
reproduce the input radii in the output space, it seems in fact to be
doing a worse job than densMAP. But it suffers less from outliers than
densMAP which is something.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<ul>
<li>I should probably be clear that I don’t think there’s anything wrong
with densMAP.</li>
<li>I am just currently too lazy to make all the changes in
<code>uwot</code> it would need to be implemented. Hence leopold’s
creation.</li>
<li>Neither leopold’s definition of local radii or the results exactly
map that of densMAP. So don’t go looking to reproduce densMAP plots
exactly with it.</li>
<li>I think the leopold results look fine. The dense clusters get
smaller and the diffuse clusters get larger, although in the latter case
not to the same extent as densMAP. However, that isn’t a big
disadvantage from my perspective.</li>
<li>densMAP does a better job in terms of the correlation between its
input and output radii.</li>
<li>Qualitatively, the densMAP and leopold results are quite
similar.</li>
<li>The correlations between the leopold definition of local radii and
the densMAP version are pretty high for real datasets. So I venture to
suggest they encode quite similar information.</li>
</ul>
<p>If you want to use leopold in <code>uwot</code>:</p>
<ul>
<li>Set the <code>dens_scale</code> parameter to a value between 0
(exactly like UMAP) to 1 (use the full range of useful <code>a</code>
values).</li>
<li>Using leopold doesn’t seem to require extra epochs and you don’t
need to worry about having to run normal UMAP for a number of epochs
before applying leopold.</li>
<li>Nor does it seem to benefit from a larger value of
<code>n_neighbors</code>.</li>
<li>I have re-run the results with <code>n_neighbors = 15</code> and
default <code>n_epochs</code> and not noticed a very big effect compared
to the results here, so I am not showing them as there are already way
too many images on this page.</li>
<li>You can transform new data with models generated where
<code>dens_scale</code> is set. When UMAP transforms new data, an
adjusted local connectivity is used which affects both <span class="math inline">\(\sigma\)</span> and <span class="math inline">\(\rho\)</span> so the estimated values of <span class="math inline">\(R_i\)</span> are not as precise as I would like,
but the effect seems to be quite small.</li>
<li>Even if you don’t use the local radii to generate the UMAP layout,
coloring the results by the log of <code>localr</code> is quite
informative as to which parts of the embedding you would expect to
shrink or expand.</li>
<li>A conservative use of <em>leopold</em> would be to run UMAP
normally, visualize the results coloring by <code>localr</code> and then
if there are obvious clusters that are a lighter or darker hue, run with
<code>dens_scale = 1</code> from the current coordinates for a couple of
hundred more epochs.</li>
</ul>
<p>Here’s how you use it with <code>iris</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris_leopold</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">iris</span>, dens_scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># and if you want the local radii values</span></span>
<span><span class="va">iris_leopold</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">iris</span>, dens_scale <span class="op">=</span> <span class="fl">1</span>, ret_extra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"localr"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by James Melville.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
