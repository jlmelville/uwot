<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="uwot">
<title>Mixed Data Types • uwot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mixed Data Types">
<meta property="og:description" content="uwot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">uwot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.16.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/uwot.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jlmelville/uwot/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Mixed Data Types</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jlmelville/uwot/blob/HEAD/vignettes/articles/mixed-data-types.Rmd" class="external-link"><code>vignettes/articles/mixed-data-types.Rmd</code></a></small>
      <div class="d-none name"><code>mixed-data-types.Rmd</code></div>
    </div>

    
    
<p>The default approach of UMAP is that all your data is numeric and
will be treated as one block using the Euclidean distance metric. To use
a different metric, set the <code>metric</code> parameter,
e.g. <code>metric = "cosine"</code>.</p>
<p>Treating the data as one block may not always be appropriate.
<code>uwot</code> now supports a highly experimental approach to mixed
data types. It is not based on any deep understanding of topology and
sets, so consider it subject to change, breakage or completely
disappearing.</p>
<p>To use different metrics for different parts of a data frame, pass a
list to the <code>metric</code> parameter. The name of each item is the
metric to use and the value is a vector containing the names of the
columns (or their integer id, but I strongly recommend names) to apply
that metric to, e.g.:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"euclidean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"A2"</span><span class="op">)</span>, <span class="st">"cosine"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B1"</span>, <span class="st">"B2"</span>, <span class="st">"B3"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>this will treat columns <code>A1</code> and <code>A2</code> as one
block of data, and generate neighbor data using the Euclidean distance,
while a different set of neighbors will be generated with columns
<code>B1</code>, <code>B2</code> and <code>B3</code>, using the cosine
distance. This will create two different simplicial sets. The final set
used for optimization is the intersection of these two sets. This is
exactly the same process that is used when carrying out supervised UMAP
(except the contribution is always equal between the two sets and can’t
be controlled by the user).</p>
<p>You can repeat the same metric multiple times. For example, to treat
the petal and sepal data separately in the <code>iris</code> dataset,
but to use Euclidean distances for both, use:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"euclidean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Petal.Width"</span>, <span class="st">"Petal.Length"</span><span class="op">)</span>,</span>
<span>              <span class="st">"euclidean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span>, <span class="st">"Sepal.Length"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="indexing">Indexing<a class="anchor" aria-label="anchor" href="#indexing"></a>
</h2>
<p>As the <code>iris</code> example shows, using column names can be
very verbose. Integer indexing is supported, so the equivalent of the
above using integer indexing into the columns of <code>iris</code>
is:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"euclidean"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"euclidean"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>but internally, <code>uwot</code> strips out the non-numeric columns
from the data, and if you use Z-scaling (i.e. specify
<code>scale = "Z"</code>), zero variance columns will also be removed.
This is very likely to change the index of the columns. If you really
want to use numeric column indexes, I strongly advise not using the
<code>scale</code> argument and re-arranging your data frame if
necessary so that all non-numeric columns come after the numeric
columns.</p>
</div>
<div class="section level2">
<h2 id="categorical-columns">Categorical columns<a class="anchor" aria-label="anchor" href="#categorical-columns"></a>
</h2>
<p>supervised UMAP allows for a factor column to be used. You may now
also specify factor columns in the <code>X</code> data. Use the special
<code>metric</code> name <code>"categorical"</code>. For example, to use
the <code>Species</code> factor in standard UMAP for <code>iris</code>
along with the usual four numeric columns, use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"euclidean"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="st">"categorical"</span> <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></span></code></pre></div>
<p>Factor columns are treated differently from numeric columns:</p>
<ul>
<li>They are always treated separately, one column at a time. If you
have two factor columns, <code>cat1</code>, and <code>cat2</code>, and
you would like them included in UMAP, you should write:</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"categorical"</span> <span class="op">=</span> <span class="st">"cat1"</span>, <span class="st">"categorical"</span> <span class="op">=</span> <span class="st">"cat2"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>As a convenience, you can also write:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"categorical"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cat1"</span>, <span class="st">"cat2"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>but that doesn’t combine <code>cat1</code> and <code>cat2</code> into
one block, just saves some typing.</p>
<ul>
<li>Because of the way categorical data is intersected into a simplicial
set, you cannot have an X <code>metric</code> that specifies only
<code>categorical</code> entries. You <em>must</em> specify at least one
of the standard Annoy metrics for numeric data. For <code>iris</code>,
the following is an error:</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># wrong and bad</span></span>
<span><span class="va">metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"categorical"</span> <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span></span></code></pre></div>
<p>Specifying some numeric columns is required:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># OK</span></span>
<span><span class="va">metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"categorical"</span> <span class="op">=</span> <span class="st">"Species"</span>, <span class="st">"euclidean"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Factor columns not explicitly included in the <code>metric</code>
are still removed as usual.</li>
<li>Categorical data does not appear in the model returned when
<code>ret_model = TRUE</code> and so does not affect the project of data
used in <code>umap_transform</code>. You can still use the UMAP model to
project new data, but factor columns in the new data are ignored
(effectively working like supervised UMAP).</li>
</ul>
</div>
<div class="section level2">
<h2 id="overriding-global-options">Overriding global options<a class="anchor" aria-label="anchor" href="#overriding-global-options"></a>
</h2>
<p>Some global parameters can be overridden for a specific data block by
providing a list as the value for the metric, containing the vector of
columns as the only unnamed element, and then the over-riding keyword
arguments. An example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span></span>
<span>    <span class="va">X</span>,</span>
<span>    pca <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    pca_center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      euclidean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">200</span>,</span>
<span>      euclidean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">201</span><span class="op">:</span><span class="fl">300</span>, pca <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>      manhattan <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">300</span><span class="op">:</span><span class="fl">500</span>, pca_center <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>In this case, the first <code>euclidean</code> block with be reduced
to 40 dimensions by PCA with centering applied. The second
<code>euclidean</code> block will not have PCA applied to it. The
<code>manhattan</code> block will have PCA applied to it, but no
centering is carried out.</p>
<p>Currently, only <code>pca</code> and <code>pca_center</code> are
supported for overriding by this method, because this feature exists
only to allow for the case where you have mixed real-valued and binary
data, and you want to carry out PCA on both. It’s typical to carry out
centering on real-value data before PCA, but <em>not</em> to do so with
binary data.</p>
</div>
<div class="section level2">
<h2 id="y-data">
<code>y</code> data<a class="anchor" aria-label="anchor" href="#y-data"></a>
</h2>
<p>The handling of <code>y</code> data has been extended to allow for
data frames, and <code>target_metric</code> works like
<code>metric</code>: multiple numeric blocks with different metrics can
be specified, and categorical data can be specified with
<code>categorical</code>. However, unlike <code>X</code>, the default
behavior for <code>y</code> is to include all factor columns. Any
numeric data found will be treated as one block, so if you have multiple
numeric columns that you want treated separately, you should specify
each column separately:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target_metric</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"euclidean"</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"euclidean"</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
<p>I suspect that the vast majority of <code>y</code> data is one
column, so the default behavior will be fine most of the time.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by James Melville.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
