<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mid-Spectral Initialization • uwot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Mid-Spectral Initialization">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">uwot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/uwot.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jlmelville/uwot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Mid-Spectral Initialization</h1>
            
            <h4 data-toc-skip class="date">December 31 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jlmelville/uwot/blob/v0.2.3/vignettes/articles/mid-spectral-initialization.Rmd" class="external-link"><code>vignettes/articles/mid-spectral-initialization.Rmd</code></a></small>
      <div class="d-none name"><code>mid-spectral-initialization.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <a href="https://jlmelville.github.io/uwot/articles/init.html">initialization
article</a> describes some ways to initialize the embedding process.
Really you have two options: a spectral initialization (the default) and
PCA, which is what you will use if the affinity graph contains
disconnected components. A third option, the “approximate global”
spectral method attempts to allow for spectral initialization in the
face of disconnections by adding some random edges to the affinity
graph. This mainly works, but it did change the results for the
<code>isoswiss</code> dataset (and not for the better) suggesting that
the <code>agspectral</code> initialization was perturbing the
coordinates in a way that was not helpful.</p>
<p>One of the things that <a href="https://github.com/YingfanWang/PaCMAP" class="external-link">PaCMAP</a> does is include
the concept of “mid-near” pairs. The process is:</p>
<ol style="list-style-type: decimal">
<li>Pick <code>n</code> random neighbors for each point (<code>n</code>
is usually 6)</li>
<li>Sort them by distance and keep the <code>k</code>-th closest
(<code>k</code> is usually 2)</li>
<li>Repeat <code>m</code> times (<code>m</code> is usually 10).</li>
</ol>
<p>This results in each point having <code>m</code> neighbors where the
distribution isn’t uniformly random, but is instead biased towards
slightly nearer neighbors.</p>
<p>In PaCMAP, these are added to the graph as additional edges, but
given a different set of weights and schedule in the first phases of the
optimization.</p>
<p>Because they are not involved in the final step of the optimization,
you could view the mid-near pairs as a way of enforcing extra
longer-range structure for the final stage of the embedding fine-tunes
the layout. So could we add these to the spectral initialization and get
some extra structure in the initial embedding? At the very least, it’s
likely that adding these extra edges will help with the disconnected
components problem and allow for a spectral-like initialization.</p>
</div>
<div class="section level2">
<h2 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h2>
<p>Here’s how I imagine this working:</p>
<ol style="list-style-type: decimal">
<li>Create the mid-near pairs as described above.</li>
<li>Use the <code>uwot</code> function <code>similarity_graph</code> to
generate a “mid affinity graph” using the mid-near pairs.</li>
<li>Create the nearest neighbor graph in the usual way. You can also use
<code>similarity_graph</code> for this.</li>
<li>Combine the two graphs by adding the mid-near pairs to the nearest
neighbor graph. Probably we will need to ensure the emphasis remains on
the nearest neighbor graph, so this should be a weighted sum of the two
graphs.</li>
<li>Do spectral initialization on the combined graph.</li>
<li>Use this as the initial embedding for the optimization.</li>
</ol>
<p>Below are some functions to make this work. Note that:</p>
<ul>
<li>You need to have <a href="https://cran.r-project.org/package=rnndescent" class="external-link">rnndescent</a>
installed.</li>
<li>You will need to borrow the <code>sort_knn_graph</code> function
from the code given in the <a href="https://jlmelville.github.io/uwot/articles/locally-scaled-neighbors.html">locally-scaled-neighbors</a>
article.</li>
<li>There are tons of internal <code>uwot</code> functions used here. I
do not plan to support this officially at the moment, but I don’t want
to break this myself, so it’s likely to be stable (or I will update the
code below to keep it working with future versions of
<code>uwot</code>).</li>
<li>In the code below I assume you have generated the nearest neighbors
externally to <code>uwot</code> via something like
<code>rnndescent</code>. Because <code>similiarity_graph</code> can
return the nearest neighbors (via <code>ret_extra = "nn"</code>) the
code could be changed to allow for the nearest neighbors to be returned
from calling <code>mid_spectral_init</code> directly. I leave this as an
exercise for the reader.</li>
<li>I have also assumed we always use Euclidean distance.
<code><a href="https://jlmelville.github.io/rnndescent/reference/random_knn.html" class="external-link">rnndescent::random_knn</a></code> can use other distances, but I have
not implemented this here.</li>
</ul>
<p>To use this code do something like:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nn_graph</span> <span class="op">&lt;-</span> <span class="fu">rnndescent</span><span class="fu">::</span><span class="fu"><a href="https://jlmelville.github.io/rnndescent/reference/rnnd_knn.html" class="external-link">rnnd_knn</a></span><span class="op">(</span><span class="va">X</span>, k <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">init_coords</span> <span class="op">&lt;-</span> <span class="fu">mid_spectral_init</span><span class="op">(</span><span class="va">X</span>, <span class="va">nn_graph</span>, mid_nnbrs <span class="op">=</span> <span class="fl">4</span>, graph_weight <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="va">umap_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap2.html">umap2</a></span><span class="op">(</span><span class="va">X</span>, nn_method <span class="op">=</span> <span class="va">nn_graph</span>, init <span class="op">=</span> <span class="va">init_coords</span><span class="op">)</span></span></code></pre></div>
<p>The two parameters you are most likely to want to play around with
are <code>mid_nnbrs</code> and <code>graph_weight</code>. The former is
the number of mid-near pairs to generate for each point, and the latter
is the weight to give the nearest neighbor graph in the combined graph.
The higher the value, the more like the typical spectral initialization
you will get.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pacmap_mid_nbrs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>,</span>
<span>                            <span class="va">k</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                            <span class="va">n_rand</span> <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                            <span class="va">nth_closest</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                            <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">varargs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>  <span class="va">varargs</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">Matrix</span><span class="fu">::</span><span class="fu">t</span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span>  <span class="va">varargs</span><span class="op">$</span><span class="va">k</span> <span class="op">&lt;-</span> <span class="va">n_rand</span></span>
<span>  <span class="va">varargs</span><span class="op">$</span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="st">"C"</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">varargs</span><span class="op">$</span><span class="va">threads</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">varargs</span><span class="op">$</span><span class="va">n_threads</span> <span class="op">&lt;-</span> <span class="fu">default_num_threads</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span>,</span>
<span>    dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">random_nbrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="fu">rnndescent</span><span class="fu">::</span><span class="va"><a href="https://jlmelville.github.io/rnndescent/reference/random_knn.html" class="external-link">random_knn</a></span>, <span class="va">varargs</span><span class="op">)</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">idx</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">random_nbrs</span><span class="op">$</span><span class="va">idx</span><span class="op">[</span>, <span class="va">nth_closest</span><span class="op">]</span></span>
<span>    <span class="va">res</span><span class="op">$</span><span class="va">dist</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">random_nbrs</span><span class="op">$</span><span class="va">dist</span><span class="op">[</span>, <span class="va">nth_closest</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">sort_knn_graph</span><span class="op">(</span><span class="va">res</span>, enforce_self_first <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">res</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">weighted_affinity_graph</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>,</span>
<span>                                    <span class="va">nn_graph</span>,</span>
<span>                                    <span class="va">midn_graph</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                    <span class="va">mid_nnbrs</span> <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                                    <span class="va">mid_select</span> <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                                    <span class="va">mid_nth_closest</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                    <span class="va">graph_weight</span> <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>                                    <span class="va">n_threads</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                    <span class="va">verbose</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">n_threads</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_threads</span> <span class="op">&lt;-</span> <span class="fu">default_num_threads</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">midn_graph</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"X must be provided if midn_graph is NULL"</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu">uwot</span><span class="fu">:::</span><span class="fu">tsmessage</span><span class="op">(</span></span>
<span>      <span class="st">"Generating mid neighbor graph with mid_nnbrs="</span>,</span>
<span>      <span class="va">mid_nnbrs</span>,</span>
<span>      <span class="st">" ("</span>,</span>
<span>      <span class="va">mid_nth_closest</span>,</span>
<span>      <span class="st">" from "</span>,</span>
<span>      <span class="va">mid_select</span>,</span>
<span>      <span class="st">")"</span>,</span>
<span>      <span class="st">" using "</span>,</span>
<span>      <span class="va">n_threads</span>,</span>
<span>      <span class="st">" threads"</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">midn_graph</span> <span class="op">&lt;-</span> <span class="fu">pacmap_mid_nbrs</span><span class="op">(</span></span>
<span>      <span class="va">X</span>,</span>
<span>      k <span class="op">=</span> <span class="va">mid_nnbrs</span>,</span>
<span>      n_rand <span class="op">=</span> <span class="va">mid_select</span>,</span>
<span>      nth_closest <span class="op">=</span> <span class="va">mid_nth_closest</span>,</span>
<span>      n_threads <span class="op">=</span> <span class="va">n_threads</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">uwot</span><span class="fu">:::</span><span class="fu">tsmessage</span><span class="op">(</span><span class="st">"Generating near-affinity graph"</span><span class="op">)</span></span>
<span>  <span class="va">nbr_affinity_graph</span> <span class="op">&lt;-</span> <span class="fu">uwot</span><span class="fu">::</span><span class="fu"><a href="../reference/similarity_graph.html">similarity_graph</a></span><span class="op">(</span></span>
<span>    nn_method <span class="op">=</span> <span class="va">nn_graph</span>,</span>
<span>    n_threads <span class="op">=</span> <span class="va">n_threads</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">uwot</span><span class="fu">:::</span><span class="fu">tsmessage</span><span class="op">(</span><span class="st">"Generating mid-affinity graph"</span><span class="op">)</span></span>
<span>  <span class="va">mid_affinity_graph</span> <span class="op">&lt;-</span> <span class="fu">uwot</span><span class="fu">::</span><span class="fu"><a href="../reference/similarity_graph.html">similarity_graph</a></span><span class="op">(</span></span>
<span>    nn_method <span class="op">=</span> <span class="va">midn_graph</span>,</span>
<span>    n_threads <span class="op">=</span> <span class="va">n_threads</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu">uwot</span><span class="fu">:::</span><span class="fu">tsmessage</span><span class="op">(</span></span>
<span>    <span class="st">"Combining near and mid neighbor graphs with graph weight "</span>,</span>
<span>    <span class="va">graph_weight</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">graph_weight</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">affinity_graph</span> <span class="op">&lt;-</span> <span class="va">nbr_affinity_graph</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">graph_weight</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">affinity_graph</span> <span class="op">&lt;-</span> <span class="va">mid_affinity_graph</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">affinity_graph</span> <span class="op">&lt;-</span> <span class="va">graph_weight</span> <span class="op">*</span> <span class="va">nbr_affinity_graph</span> <span class="op">+</span></span>
<span>      <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">graph_weight</span><span class="op">)</span> <span class="op">*</span> <span class="va">mid_affinity_graph</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">affinity_graph</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">mid_spectral_init</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>,</span>
<span>                              <span class="va">nn_graph</span>,</span>
<span>                              <span class="va">midn_graph</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                              <span class="va">mid_nnbrs</span> <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                              <span class="va">mid_select</span> <span class="op">=</span> <span class="fl">6</span>,</span>
<span>                              <span class="va">mid_nth_closest</span> <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                              <span class="va">graph_weight</span> <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>                              <span class="va">n_threads</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                              <span class="va">verbose</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">n_threads</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n_threads</span> <span class="op">&lt;-</span> <span class="fu">uwot</span><span class="fu">:::</span><span class="fu">default_num_threads</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">affinity_graph</span> <span class="op">&lt;-</span> <span class="fu">weighted_affinity_graph</span><span class="op">(</span></span>
<span>    X <span class="op">=</span> <span class="va">X</span>,</span>
<span>    nn_graph <span class="op">=</span> <span class="va">nn_graph</span>,</span>
<span>    midn_graph <span class="op">=</span> <span class="va">midn_graph</span>,</span>
<span>    mid_nnbrs <span class="op">=</span> <span class="va">mid_nnbrs</span>,</span>
<span>    mid_select <span class="op">=</span> <span class="va">mid_select</span>,</span>
<span>    mid_nth_closest <span class="op">=</span> <span class="va">mid_nth_closest</span>,</span>
<span>    graph_weight <span class="op">=</span> <span class="va">graph_weight</span>,</span>
<span>    n_threads <span class="op">=</span> <span class="va">n_threads</span>,</span>
<span>    verbose <span class="op">=</span> <span class="va">verbose</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu">uwot</span><span class="fu">:::</span><span class="fu">spectral_init</span><span class="op">(</span><span class="va">affinity_graph</span>, verbose <span class="op">=</span> <span class="va">verbose</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">uwot</span><span class="fu">:::</span><span class="fu">tsmessage</span><span class="op">(</span><span class="st">"Finished initializing"</span><span class="op">)</span></span>
<span>  <span class="va">coords</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="datasets">Datasets<a class="anchor" aria-label="anchor" href="#datasets"></a>
</h2>
<p>Brief descriptions of the datasets used here can be found in the <a href="https://jlmelville.github.io/uwot/articles/umap-examples.html">examples
article</a>.</p>
</div>
<div class="section level2">
<h2 id="effect-of-weight-on-initial-coordinates">Effect of weight on initial coordinates<a class="anchor" aria-label="anchor" href="#effect-of-weight-on-initial-coordinates"></a>
</h2>
<p>In the following I have set <code>mid_nnbrs = 4</code>. We don’t want
the number of these edges to be too high, because we shouldn’t need too
many to get a fully connected graph. In practice I have found that
<code>mid_nnbrs = 2</code> is also fine, and usually
<code>mid_nnbrs = 1</code> also works.</p>
<p>Let’s take a look at <code>mammoth</code> to start with. It has a
very different result if you initialize with the spectral method vs PCA.
Below are the initial mid-spectral initialization with different values
of <code>graph_weight</code>, which is given in the header of the table
cell. As we go left to right, top to bottom we increase from 0 (just use
mid-near neighbors) to 1 (only use k-nearest neighbors, standard
spectral initialization). I’ve also included the PCA results for
comparison.</p>
<div class="section level3">
<h3 id="mammoth">mammoth<a class="anchor" aria-label="anchor" href="#mammoth"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-pca.png" alt="mammoth-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-0.png" alt="mammoth-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-0.25.png" alt="mammoth-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-0.5.png" alt="mammoth-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-0.75.png" alt="mammoth-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-0.9.png" alt="mammoth-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-0.99.png" alt="mammoth-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-0.999.png" alt="mammoth-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmammoth-1.png" alt="mammoth-1"></td>
</tr></tbody>
</table>
<p>First of all, sorry about the odd orientation of the mammoth, but
them’s the breaks. What’s apparent is that the addition of mid-near
neighbors immediately makes the coordinates take on a very similar
layout to the PCA initialization. Now I know you’re saying “no, it looks
like a fuzzy mess”. True, but you can see that the legs are placed
together, i.e. it’s the same side-on view as the PCA result. Compare
that to the k-nearest neighbors initialization (bottom right), which is
more like looking at the mammoth from above. There are two lines, one at
about 12 o’clock and the other at about 7 o’clock. Those are the legs,
clearly separate from each other, and split by the torso.</p>
<p>What’s more than slightly annoying to me is that I have been unable
to reproduce the “pure” spectral initialization with any value of
<code>graph_weight</code> &lt; 1. The presence of the mid-near edges
pushes the coordinates into the “PCA-like” orientation. Now the good
news there is that the PaCMAP paper makes great hay of the mammoth
embedding looking more sensible under their method than UMAP and part of
that is the side-on view.</p>
<p>In terms of why this happens, it’s notable that the mammoth spectral
initialization takes a comparative age to converge. Most initializations
for datasets of this size (50,000 items) take a second, or a couple of
seconds at most. Spectral initialization chugs along for nearly a
minute. That’s not a good sign, so there must be something about the
mammoth dataset that makes it troublesome. Probably fiddling with the
parameters to <code>RSpectra</code>’s solution (more memory, more
iterations) would help, but the mid-spectral initialization is not
necessarily worse than the spectral initialization and it also completes
in a second.</p>
</div>
<div class="section level3">
<h3 id="isoswiss">isoswiss<a class="anchor" aria-label="anchor" href="#isoswiss"></a>
</h3>
<p>Another low-dimensional dataset, but this one is the classic manifold
that is perfect for a spectral approach (well, apart from the <a href="https://arxiv.org/abs/1505.06118" class="external-link">repeated eigendirections
problem</a>, but UMAP optimization helps fix that). What you certainly
won’t want to do is to use PCA in this case. Given that PCA-ness seems
to creep into the <code>mammoth</code> results with
<code>graph_weight</code> &lt; 1, let’s see what happens.</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-pca.png" alt="isoswiss-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-0.png" alt="isoswiss-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-0.25.png" alt="isoswiss-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-0.5.png" alt="isoswiss-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-0.75.png" alt="isoswiss-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-0.9.png" alt="isoswiss-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-0.99.png" alt="isoswiss-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-0.999.png" alt="isoswiss-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fisoswiss-1.png" alt="isoswiss-1"></td>
</tr></tbody>
</table>
<p>Hard to really see here, but in the <code>pca</code> case you are
basically looking at the swiss role perpendicular to rolled up part. So
those apparent four darker lines are where the folding is occurring. The
mid-spectral cases all struggle to avoid wanting to fold it up or just
make what seems like a bit of a mess. The closes we get is with
<code>graph_weight = 0.999</code>. If you increase the graph_weight to
<code>0.9999</code> you <em>do</em> get the fully unrolled swiss roll,
but that doesn’t work for <code>mammoth</code>, and if you are up at the
four 9s you might as well just do the normal spectral initialization at
this point.</p>
<p>One more low-dimensional and manifold-based dataset:</p>
</div>
<div class="section level3">
<h3 id="scurvehole">scurvehole<a class="anchor" aria-label="anchor" href="#scurvehole"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-pca.png" alt="scurvehole-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-0.png" alt="scurvehole-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-0.25.png" alt="scurvehole-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-0.5.png" alt="scurvehole-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-0.75.png" alt="scurvehole-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-0.9.png" alt="scurvehole-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-0.99.png" alt="scurvehole-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-0.999.png" alt="scurvehole-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fscurvehole-1.png" alt="scurvehole-1"></td>
</tr></tbody>
</table>
<p>No real sign of the PCA result here. The “horseshoe” shape is
apparent at most settings. On the one hand that is characteristic of the
spectral initialization. On the other, this is a classic sign of the
“repeated eigendirections problem”, but we aren’t going to solve that
here. You do have to get all the way to
<code>graph_weight = 0.999</code> to get weird hook-looking appendages
at the end of the curve to disappear, but at least we get there.</p>
<p>I don’t really care about these datasets. Let’s take a look at a
higher dimensional more “blobby” dataset. Like <code>mnist</code>:</p>
</div>
<div class="section level3">
<h3 id="mnist">mnist<a class="anchor" aria-label="anchor" href="#mnist"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-pca.png" alt="mnist-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-0.png" alt="mnist-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-0.25.png" alt="mnist-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-0.5.png" alt="mnist-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-0.75.png" alt="mnist-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-0.9.png" alt="mnist-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-0.99.png" alt="mnist-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-0.999.png" alt="mnist-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmnist-1.png" alt="mnist-1"></td>
</tr></tbody>
</table>
<p>You can also get to something that looks very spectral-like with with
a <code>graph_weight = 0.99</code> or above. And the
<code>graph_weight = 0.9</code> results is quite pleasing, showing a
visible cluster structure and seeming to sit intermediate between the
PCA and spectral result. That’s more like it.</p>
<p>Let’s try one more high-dimensional dataset:</p>
</div>
<div class="section level3">
<h3 id="fashion">fashion<a class="anchor" aria-label="anchor" href="#fashion"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-pca.png" alt="fashion-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-0.png" alt="fashion-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-0.25.png" alt="fashion-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-0.5.png" alt="fashion-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-0.75.png" alt="fashion-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-0.9.png" alt="fashion-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-0.99.png" alt="fashion-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-0.999.png" alt="fashion-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ffashion-1.png" alt="fashion-1"></td>
</tr></tbody>
</table>
<p>Sort of the same deal here as with <code>mnist</code>.</p>
<p>Another dataset I want to check is <code>tomoradar</code>. With the
Python UMAP package and this data, I have found this dataset will take
several minutes to converge. In <code>uwot</code> it can take over a
minute (the difference is due to the implementation of the spectral
decomposition). So like <code>mammoth</code>, this would be a good test
of whether convergence can be sped up. For this dataset, we use
<code>n_neighbors = 50</code>, because otherwise there is a disconnected
component. I want to compare the results here with a successful spectral
initialization because of the slow convergence.</p>
</div>
<div class="section level3">
<h3 id="tomoradar">tomoradar<a class="anchor" aria-label="anchor" href="#tomoradar"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-pca.png" alt="tomoradar-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-0.png" alt="tomoradar-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-0.25.png" alt="tomoradar-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-0.5.png" alt="tomoradar-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-0.75.png" alt="tomoradar-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-0.9.png" alt="tomoradar-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-0.99.png" alt="tomoradar-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-0.999.png" alt="tomoradar-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftomoradar-1.png" alt="tomoradar-1"></td>
</tr></tbody>
</table>
<p>Even with a high <code>graph_weight</code>, the results resemble the
PCA results more than the spectral results. It seems like a situation
like with <code>mammoth</code>.</p>
<p>The next set of results are for datasets where you can’t do a
spectral initialization. <code>uwot</code> detects disconnected
components in the graph, steps in and makes you do PCA instead. So I
won’t try to go to <code>graph_weight = 1</code>. Also, nothing
interesting happens at <code>graph_weight = 0.25</code> or
<code>graph_weight = 0.75</code>, so we can discard an entire row of
output. Without any ground truth to compare to, I am just looking for a
suitably “spectral-like” result at high <code>graph_weight</code>:
pointy, spiky, radial, etc. especially compared to the more diffuse PCA
results.</p>
</div>
<div class="section level3">
<h3 id="coil20">coil20<a class="anchor" aria-label="anchor" href="#coil20"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil20-pca.png" alt="coil20-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil20-0.png" alt="coil20-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil20-0.5.png" alt="coil20-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil20-0.9.png" alt="coil20-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil20-0.99.png" alt="coil20-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil20-0.999.png" alt="coil20-0.999"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="coil100">coil100<a class="anchor" aria-label="anchor" href="#coil100"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil100-pca.png" alt="coil100-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil100-0.png" alt="coil100-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil100-0.5.png" alt="coil100-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil100-0.9.png" alt="coil100-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil100-0.99.png" alt="coil100-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fcoil100-0.999.png" alt="coil100-0.999"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="norb">norb<a class="anchor" aria-label="anchor" href="#norb"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fnorb-pca.png" alt="norb-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fnorb-0.png" alt="norb-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fnorb-0.5.png" alt="norb-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fnorb-0.9.png" alt="norb-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fnorb-0.99.png" alt="norb-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fnorb-0.999.png" alt="norb-0.999"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="tasic2018">tasic2018<a class="anchor" aria-label="anchor" href="#tasic2018"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftasic2018-pca.png" alt="tasic2018-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftasic2018-0.png" alt="tasic2018-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftasic2018-0.5.png" alt="tasic2018-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftasic2018-0.9.png" alt="tasic2018-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftasic2018-0.99.png" alt="tasic2018-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Ftasic2018-0.999.png" alt="tasic2018-0.999"></td>
</tr></tbody>
</table>
<p>Ok, similar pattern emerges. We do have a successful enough looking
spectral shape at higher <code>graph_weight</code> values (and these all
converged quickly). Lower values inject some more PCA-like structure
into things.</p>
<p><code>macosko2015</code> and its PCA-reduced version are all fully
connected, but I am including them here because they are transcriptomics
datasets like <code>tasic2018</code>.</p>
</div>
<div class="section level3">
<h3 id="macosko2015">macosko2015<a class="anchor" aria-label="anchor" href="#macosko2015"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015-pca.png" alt="macosko2015-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015-0.png" alt="macosko2015-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015-0.5.png" alt="macosko2015-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015-0.9.png" alt="macosko2015-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015-0.99.png" alt="macosko2015-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015-0.999.png" alt="macosko2015-0.999"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="macosko2015pca100">macosko2015pca100<a class="anchor" aria-label="anchor" href="#macosko2015pca100"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015pca100-pca.png" alt="macosko2015pca100-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015pca100-0.png" alt="macosko2015pca100-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015pca100-0.5.png" alt="macosko2015pca100-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015pca100-0.9.png" alt="macosko2015pca100-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015pca100-0.99.png" alt="macosko2015pca100-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Finit%2Fmacosko2015pca100-0.999.png" alt="macosko2015pca100-0.999"></td>
</tr></tbody>
</table>
<p><code>macosko2015</code> looking reliably terrible even in spectral
form, but <code>macosko2015pca100</code> seems in line with the other
datasets.</p>
<p>Overall, the initialization is doing what I want it to do with “real”
datasets at least. Does it translate into different results when fed
into UMAP?</p>
</div>
</div>
<div class="section level2">
<h2 id="umap">UMAP<a class="anchor" aria-label="anchor" href="#umap"></a>
</h2>
<p>These are the UMAP embeddings of the datasets with the
initializations above. I use <code>umap2</code> with the same nearest
neighbors that produced the initialization (but no mid-near neighbors).
The only deviation from default values is to use
<code>rng_type = "deterministic"</code> to remove any effect of random
numbers (which can’t always be controlled with multiple threads even
with the same seed). This probably introduces some other bias, but is
probably ok.</p>
<p>There is also one change for <code>norb</code> only. It never does
well with <code>n_neighbors = 15</code> so for that dataset, I set
<code>n_neighbors = 50</code>, to make the results more legible
(probably there are other datasets where I should do this).</p>
<p>In most cases, there is nothing too surprising about the results if
you know how the initializations look.</p>
<div class="section level3">
<h3 id="mammoth-1">mammoth<a class="anchor" aria-label="anchor" href="#mammoth-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-pca.png" alt="mammoth-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-0.png" alt="mammoth-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-0.25.png" alt="mammoth-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-0.5.png" alt="mammoth-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-0.75.png" alt="mammoth-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-0.9.png" alt="mammoth-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-0.99.png" alt="mammoth-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-0.999.png" alt="mammoth-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmammoth-1.png" alt="mammoth-1"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="scurvehole-1">scurvehole<a class="anchor" aria-label="anchor" href="#scurvehole-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-pca.png" alt="scurvehole-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-0.png" alt="scurvehole-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-0.25.png" alt="scurvehole-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-0.5.png" alt="scurvehole-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-0.75.png" alt="scurvehole-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-0.9.png" alt="scurvehole-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-0.99.png" alt="scurvehole-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-0.999.png" alt="scurvehole-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fscurvehole-1.png" alt="scurvehole-1"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="isoswiss-1">isoswiss<a class="anchor" aria-label="anchor" href="#isoswiss-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-pca.png" alt="isoswiss-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-0.png" alt="isoswiss-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-0.25.png" alt="isoswiss-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-0.5.png" alt="isoswiss-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-0.75.png" alt="isoswiss-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-0.9.png" alt="isoswiss-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-0.99.png" alt="isoswiss-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-0.999.png" alt="isoswiss-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fisoswiss-1.png" alt="isoswiss-1"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="mnist-1">mnist<a class="anchor" aria-label="anchor" href="#mnist-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-pca.png" alt="mnist-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-0.png" alt="mnist-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-0.25.png" alt="mnist-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-0.5.png" alt="mnist-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-0.75.png" alt="mnist-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-0.9.png" alt="mnist-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-0.99.png" alt="mnist-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-0.999.png" alt="mnist-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmnist-1.png" alt="mnist-1"></td>
</tr></tbody>
</table>
<p>In this case the PCA result has some unfortunate overlapping and
breaking up of the clusters, so everything is an improvement on
that.</p>
</div>
<div class="section level3">
<h3 id="fashion-1">fashion<a class="anchor" aria-label="anchor" href="#fashion-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-pca.png" alt="fashion-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-0.png" alt="fashion-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-0.25.png" alt="fashion-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-0.5.png" alt="fashion-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-0.75.png" alt="fashion-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-0.9.png" alt="fashion-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-0.99.png" alt="fashion-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-0.999.png" alt="fashion-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ffashion-1.png" alt="fashion-1"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="tomoradar-1">tomoradar<a class="anchor" aria-label="anchor" href="#tomoradar-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.25</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-pca.png" alt="tomoradar-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-0.png" alt="tomoradar-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-0.25.png" alt="tomoradar-0.25"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.5</th>
<th align="center">0.75</th>
<th align="center">0.9</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-0.5.png" alt="tomoradar-0.5"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-0.75.png" alt="tomoradar-0.75"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-0.9.png" alt="tomoradar-0.9"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.99</th>
<th align="center">0.999</th>
<th align="center">1</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-0.99.png" alt="tomoradar-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-0.999.png" alt="tomoradar-0.999"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftomoradar-1.png" alt="tomoradar-1"></td>
</tr></tbody>
</table>
<p>With the usual caveat that UMAP results for this dataset don’t look
like much of anything, at least with a
<code>graph_weight = 0.999</code>, you can get a result which resembles
what you get from spectral initialization. But it still takes around
20-30 seconds on my machine. That’s still somewhere around 2-3 times
faster than the pure spectral initialization, so a bit of a win.</p>
</div>
<div class="section level3">
<h3 id="coil20-1">coil20<a class="anchor" aria-label="anchor" href="#coil20-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil20-pca.png" alt="coil20-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil20-0.png" alt="coil20-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil20-0.5.png" alt="coil20-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil20-0.9.png" alt="coil20-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil20-0.99.png" alt="coil20-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil20-0.999.png" alt="coil20-0.999"></td>
</tr></tbody>
</table>
<p>The downside of having disconnected components is that the clusters
are pretty free to move about relative to each other, so there’s not
always an obvious transition as <code>graph_weight</code> incraeses as
can be seen here.</p>
</div>
<div class="section level3">
<h3 id="coil100-1">coil100<a class="anchor" aria-label="anchor" href="#coil100-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil100-pca.png" alt="coil100-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil100-0.png" alt="coil100-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil100-0.5.png" alt="coil100-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil100-0.9.png" alt="coil100-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil100-0.99.png" alt="coil100-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fcoil100-0.999.png" alt="coil100-0.999"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="norb-1">norb<a class="anchor" aria-label="anchor" href="#norb-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fnorb-pca.png" alt="norb-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fnorb-0.png" alt="norb-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fnorb-0.5.png" alt="norb-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fnorb-0.9.png" alt="norb-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fnorb-0.99.png" alt="norb-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fnorb-0.999.png" alt="norb-0.999"></td>
</tr></tbody>
</table>
<p>At least in the <code>norb</code> case, I think the mid-spectral
initialization improves on the PCA results, as it doesn’t break up the
pink/orange cluster in the top center.</p>
</div>
<div class="section level3">
<h3 id="macosko2015-1">macosko2015<a class="anchor" aria-label="anchor" href="#macosko2015-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015-pca.png" alt="macosko2015-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015-0.png" alt="macosko2015-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015-0.5.png" alt="macosko2015-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015-0.9.png" alt="macosko2015-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015-0.99.png" alt="macosko2015-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015-0.999.png" alt="macosko2015-0.999"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="macosko2015pca100-1">macosko2015pca100<a class="anchor" aria-label="anchor" href="#macosko2015pca100-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015pca100-pca.png" alt="macosko2015pca100-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015pca100-0.png" alt="macosko2015pca100-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015pca100-0.5.png" alt="macosko2015pca100-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015pca100-0.9.png" alt="macosko2015pca100-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015pca100-0.99.png" alt="macosko2015pca100-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Fmacosko2015pca100-0.999.png" alt="macosko2015pca100-0.999"></td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="tasic2018-1">tasic2018<a class="anchor" aria-label="anchor" href="#tasic2018-1"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">pca</th>
<th align="center">0</th>
<th align="center">0.5</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftasic2018-pca.png" alt="tasic2018-pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftasic2018-0.png" alt="tasic2018-0"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftasic2018-0.5.png" alt="tasic2018-0.5"></td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center">0.9</th>
<th align="center">0.99</th>
<th align="center">0.999</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftasic2018-0.9.png" alt="tasic2018-0.9"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftasic2018-0.99.png" alt="tasic2018-0.99"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fumap%2Ftasic2018-0.999.png" alt="tasic2018-0.999"></td>
</tr></tbody>
</table>
<p>Cluster arrangement seems to be more consistently different in the
mid-spectral initialization versus PCA in terms of the relative location
of the orange-red versus the pink-purple cluster.</p>
<p>My conclusions from this set of results is that in most cases, there
isn’t much difference between PCA and spectral initialization, but for
some datasets, you can get some slightly different results with a
spectral initialization and it might be improved over PCA, so having
this available <em>could</em> be useful.</p>
<p>But not useful enough for me to add this to <code>uwot</code>
natively.</p>
</div>
</div>
<div class="section level2">
<h2 id="bmnn-initialization">BMNN Initialization<a class="anchor" aria-label="anchor" href="#bmnn-initialization"></a>
</h2>
<p>In the <a href="https://jlmelville.github.io/uwot/articles/mutual-nearest-neighbors.html">mutual
nearest neighbors</a> article, I lamented that focusing on MNN leads to
more disconnections so initialization becomes even trickier. Could mid
spectral initialization help?</p>
<p>Below I will consider 4 datasets which have a large number of
disconnected components when using mutual nearest neighbors (and are
disconnected even with just a knn graph).</p>
<p>For <code>tasic2018</code> and <code>norb</code> I will use 50
nearest neighbors: <code>norb</code> because we know it does better that
way and <code>tasic2018</code>, just in case it will also show a
difference. For <code>coil20</code> and <code>coil100</code> I will use
15 nearest neighbors as these datasets do better with a smaller number
of neighbors. I will use 5 neighbors to ensure all items have at least 5
neighbors in the graph used for UMAP. See the MNN article for more
details on the procedure.</p>
<p>For each dataset we’ll consider all four combinations of the
following settings:</p>
<ul>
<li>For the nearest neighbor graph, using either the k-nearest neighbors
or the balanced mutual nearest neighbor graph. In the results, the rows
will be marked as <code>knn&lt;k&gt;</code> or
<code>bmnn-&lt;k&gt;-&lt;m&gt;</code> respectively, where <code>k</code>
is either 50 or 15 and <code>m</code> is 5.</li>
<li>For the initialization, using either PCA or mid-spectral
initialization. For the mid-spectral initialization, the nearest
neighbor graph is either the knn graph or the balanced MNN graph.
<code>graph_weight = 0.999</code> in all these cases. In the results
table, the columns are marked as <code>pca</code> or
<code>0.999</code>.</li>
</ul>
<p>The question I want to answer here is: is initializing the
coordinates using the neighbor graph better or at least different from
using PCA?</p>
<div class="section level3">
<h3 id="tasic2018-2">tasic2018<a class="anchor" aria-label="anchor" href="#tasic2018-2"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center"></th>
<th align="center">pca</th>
<th align="center">0.999</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">knn50</td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Ftasic2018-knn_pca.png" alt="tasic2018-knn_pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Ftasic2018-knn_ms.png" alt="tasic2018-knn_ms"></td>
</tr>
<tr class="even">
<td align="center">bmnn-50-5</td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Ftasic2018-bmnn_pca.png" alt="tasic2018-bmnn_pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Ftasic2018-bmnn_ms.png" alt="tasic2018-bmnn_ms"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="norb-2">norb<a class="anchor" aria-label="anchor" href="#norb-2"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center"></th>
<th align="center">pca</th>
<th align="center">0.999</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">knn50</td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fnorb-knn_pca.png" alt="norb-knn_pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fnorb-knn_ms.png" alt="norb-knn_ms"></td>
</tr>
<tr class="even">
<td align="center">bmnn-50-5</td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fnorb-bmnn_pca.png" alt="norb-bmnn_pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fnorb-bmnn_ms.png" alt="norb-bmnn_ms"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="coil20-2">coil20<a class="anchor" aria-label="anchor" href="#coil20-2"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center"></th>
<th align="center">pca</th>
<th align="center">0.999</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">knn15</td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fcoil20-knn_pca.png" alt="coil20-knn_pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fcoil20-knn_ms.png" alt="coil20-knn_ms"></td>
</tr>
<tr class="even">
<td align="center">bmnn-15-5</td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fcoil20-bmnn_pca.png" alt="coil20-bmnn_pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fcoil20-bmnn_ms.png" alt="coil20-bmnn_ms"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="coil100-2">coil100<a class="anchor" aria-label="anchor" href="#coil100-2"></a>
</h3>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th align="center"></th>
<th align="center">pca</th>
<th align="center">0.999</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">knn15</td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fcoil100-knn_pca.png" alt="coil100-knn_pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fcoil100-knn_ms.png" alt="coil100-knn_ms"></td>
</tr>
<tr class="even">
<td align="center">bmnn-15-5</td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fcoil100-bmnn_pca.png" alt="coil100-bmnn_pca"></td>
<td align="center"><img src="img%2Fmid-spectral-initialization%2Fbmnn%2Fcoil100-bmnn_ms.png" alt="coil100-bmnn_ms"></td>
</tr>
</tbody>
</table>
<p>With <code>coil20</code> and <code>coil100</code> it would be hard to
say whether PCA or the spectral initialization is better. I think the
<code>norb</code> result is best with the spectral initialization and
maybe the <code>tasic2018</code> result too. It’s at least
different.</p>
</div>
</div>
<div class="section level2">
<h2 id="conclusions">Conclusions<a class="anchor" aria-label="anchor" href="#conclusions"></a>
</h2>
<p>If you have reason to want to avoid PCA initialization, but you have
disconnected components in your nearest neighbor graph or the spectral
initialization is having issues and failing to converge in a timely
fashion, then using the mid-spectral initialization might be worth a
try.</p>
<p>Unfortunately, like my <code>agspectral</code> attempt before, for
synthetic and manifold-like datasets, it may not be the right choice so
it’s not a guaranteed upgrade over spectral initialization in all
cases.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James Melville.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
