<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="uwot">
<title>uwot • uwot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="uwot">
<meta property="og:description" content="uwot">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">uwot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.16.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/uwot.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jlmelville/uwot/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>uwot</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jlmelville/uwot/blob/HEAD/vignettes/uwot.Rmd" class="external-link"><code>vignettes/uwot.Rmd</code></a></small>
      <div class="d-none name"><code>uwot.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jlmelville/uwot" class="external-link">uwot</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Matrix</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># See function man page for help</span></span>
<span><span class="op">?</span><span class="va">umap</span></span>
<span></span>
<span><span class="co"># Non-numeric columns are ignored, so in a lot of cases you can pass a data</span></span>
<span><span class="co"># frame directly to umap</span></span>
<span><span class="va">iris_umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">iris</span>, n_neighbors <span class="op">=</span> <span class="fl">50</span>, learning_rate <span class="op">=</span> <span class="fl">0.5</span>, init <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load mnist from somewhere, e.g.</span></span>
<span><span class="co"># devtools::install_github("jlmelville/snedata")</span></span>
<span><span class="co"># mnist &lt;- snedata::download_mnist()</span></span>
<span><span class="va">mnist_umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, n_neighbors <span class="op">=</span> <span class="fl">15</span>, min_dist <span class="op">=</span> <span class="fl">0.001</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For high dimensional datasets (&gt; 100-1000 columns) using PCA to reduce</span></span>
<span><span class="co"># dimensionality is highly recommended to avoid the nearest neighbor search</span></span>
<span><span class="co"># taking a long time. Keeping only 50 dimensions can speed up calculations</span></span>
<span><span class="co"># without affecting the visualization much</span></span>
<span><span class="va">mnist_umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, pca <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use a specific number of threads</span></span>
<span><span class="va">mnist_umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, n_neighbors <span class="op">=</span> <span class="fl">15</span>, min_dist <span class="op">=</span> <span class="fl">0.001</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, n_threads <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use a different metric</span></span>
<span><span class="va">mnist_umap_cosine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, n_neighbors <span class="op">=</span> <span class="fl">15</span>, metric <span class="op">=</span> <span class="st">"cosine"</span>, min_dist <span class="op">=</span> <span class="fl">0.001</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, n_threads <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># If you are only interested in visualization, `fast_sgd = TRUE` gives a much faster optimization</span></span>
<span><span class="va">mnist_umap_fast_sgd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, n_neighbors <span class="op">=</span> <span class="fl">15</span>, metric <span class="op">=</span> <span class="st">"cosine"</span>, min_dist <span class="op">=</span> <span class="fl">0.001</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, fast_sgd <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Supervised dimension reduction</span></span>
<span><span class="va">mnist_umap_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, n_neighbors <span class="op">=</span> <span class="fl">15</span>, min_dist <span class="op">=</span> <span class="fl">0.001</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, n_threads <span class="op">=</span> <span class="fl">8</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">mnist</span><span class="op">$</span><span class="va">Label</span>, target_weight <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add new points to an existing embedding</span></span>
<span><span class="va">mnist_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mnist</span>, <span class="fl">60000</span><span class="op">)</span></span>
<span><span class="va">mnist_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">mnist</span>, <span class="fl">10000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You must set ret_model = TRUE to return extra data we need</span></span>
<span><span class="co"># coordinates are in mnist_train_umap$embedding</span></span>
<span><span class="va">mnist_train_umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist_train</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span>, ret_model <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">mnist_test_umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap_transform.html">umap_transform</a></span><span class="op">(</span><span class="va">mnist_test</span>, <span class="va">mnist_train_umap</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the nearest neighbor data</span></span>
<span><span class="va">mnist_nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, ret_nn <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># coordinates are now in mnist_nn$embedding</span></span>
<span></span>
<span><span class="co"># Re-use the nearest neighor data and save a lot of time</span></span>
<span><span class="va">mnist_nn_spca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, nn_method <span class="op">=</span> <span class="va">mnist_nn</span><span class="op">$</span><span class="va">nn</span>, init <span class="op">=</span> <span class="st">"spca"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># No problem to have ret_nn = TRUE and ret_model = TRUE at the same time</span></span>
<span><span class="co"># Or just use the ret_extra parameter:</span></span>
<span><span class="va">mnist_nn_and_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, ret_extra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"model"</span>, <span class="st">"nn"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># You can also get to the input fuzzy graph as a sparse matrix via "fgraph"</span></span>
<span><span class="va">mnist_with_fgraph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist</span>, ret_extra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fgraph"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># equivalent for lvish is to use "P" (input probability matrix):</span></span>
<span><span class="va">mnist_with_P</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lvish.html">lvish</a></span><span class="op">(</span><span class="va">mnist</span>, ret_extra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate Petal and Sepal neighbors separately (uses intersection of the resulting sets):</span></span>
<span><span class="va">iris_umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">iris</span>, metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"euclidean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span><span class="op">)</span>,</span>
<span>                                      <span class="st">"euclidean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Can also use individual factor columns</span></span>
<span><span class="va">iris_umap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">iris</span>, metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"euclidean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span><span class="op">)</span>,</span>
<span>                                      <span class="st">"euclidean"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span><span class="op">)</span>,</span>
<span>                                      <span class="st">"categorical"</span> <span class="op">=</span> <span class="st">"Species"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Batch mode allows for multiple threads while being reproducible</span></span>
<span><span class="co"># (at the cost of needing more epochs for larger datasets)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">iris_umap_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">iris</span>, batch <span class="op">=</span> <span class="cn">TRUE</span>, n_sgd_threads <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co"># This will give the same results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">iris_umap_batch2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">iris</span>, batch <span class="op">=</span> <span class="cn">TRUE</span>, n_sgd_threads <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">iris_umap_batch</span> <span class="op">==</span> <span class="va">iris_umap_batch2</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span>
<span></span>
<span><span class="co"># Batch mode uses Adam optimizer by default. Control the parameters with the opt_args list</span></span>
<span><span class="va">iris_umap_batch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">iris</span>, batch <span class="op">=</span> <span class="cn">TRUE</span>, opt_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta1 <span class="op">=</span> <span class="fl">0.9</span>, beta2 <span class="op">=</span> <span class="fl">0.999</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="supported-distances">Supported Distances<a class="anchor" aria-label="anchor" href="#supported-distances"></a>
</h2>
<p>For small (N &lt; 4096) and Euclidean distance, exact nearest
neighbors are found using the <a href="https://cran.r-project.org/package=FNN" class="external-link">FNN</a> package.
Otherwise, approximate nearest neighbors are found using <a href="https://cran.r-project.org/package=RcppAnnoy" class="external-link">RcppAnnoy</a>. The
supported distance metrics (set by the <code>metric</code> parameter)
are:</p>
<ul>
<li>Euclidean</li>
<li>Cosine</li>
<li>Pearson Correlation (<code>correlation</code>)</li>
<li>Manhattan</li>
<li>Hamming</li>
</ul>
<p>Exactly what constitutes the cosine distance can differ between
packages. <code>uwot</code> tries to follow how the Python version of
UMAP defines it, which is 1 minus the cosine similarity. This differs
slightly from how Annoy defines its angular distance, so be aware that
<code>uwot</code> internally converts the Annoy version of the distance.
Also be aware that the Pearson correlation distance is the cosine
distance applied to row-centered vectors.</p>
<p>If you need other metrics, and can generate the nearest neighbor info
externally, you can pass the data directly to <code>uwot</code> via the
<code>nn_method</code> parameter. See the <a href="https://github.com/jlmelville/uwot#nearest-neighbor-data-format" class="external-link">Nearest
Neighbor Data Format section</a> for more details. Please note that the
Hamming support is a lot slower than the other metrics. I do not
recommend using it if you have more than a few hundred features, and
even then expect it to take several minutes during the index building
phase in situations where the Euclidean metric would take only a few
seconds.</p>
</div>
<div class="section level2">
<h2 id="multi-threading-support">Multi-threading support<a class="anchor" aria-label="anchor" href="#multi-threading-support"></a>
</h2>
<p>Parallelization can be used for the nearest neighbor index search,
the smooth knn/perplexity calibration, and the optimization, which is
the same approach that <a href="https://github.com/lferry007/LargeVis" class="external-link">LargeVis</a> takes.</p>
<p>You can (and should) adjust the number of threads via the
<code>n_threads</code>, which controls the nearest neighbor and smooth
knn calibration, and the <code>n_sgd_threads</code> parameter, which
controls the number of threads used during optimization. For the
<code>n_threads</code>, the default is the number of available cores.
For <code>n_sgd_threads</code> the default is <code>0</code>, which
ensures reproducibility of results with a fixed seed.</p>
</div>
<div class="section level2">
<h2 id="python-comparison">Python Comparison<a class="anchor" aria-label="anchor" href="#python-comparison"></a>
</h2>
<p>For the datasets I’ve tried it with, the results look at least
reminiscent of those obtained using the <a href="https://github.com/lmcinnes/umap" class="external-link">official Python
implementation</a>. Below are results for the 70,000 MNIST digits
(downloaded using the <a href="https://github.com/jlmelville/snedata" class="external-link">snedata</a> package).
Below, is the result of using the official Python UMAP implementation
(via the <a href="https://cran.r-project.org/package=reticulate" class="external-link">reticulate</a>
package). Under that is the result of using <code>uwot</code>.</p>
<p><img src="articles/img/uwot/mnist-py.png" alt="mnist-py.png"><img src="articles/img/uwot/mnist-r.png" alt="mnist-r.png"></p>
<p>The project documentation contains some more <a href="https://jlmelville.github.io/uwot/articles/umap-examples.html">examples</a>,
and <a href="https://jlmelville.github.io/uwot/articles/pycompare.html">comparison
with Python</a>.</p>
</div>
<div class="section level2">
<h2 id="limitations-and-other-issues">Limitations and Other Issues<a class="anchor" aria-label="anchor" href="#limitations-and-other-issues"></a>
</h2>
<div class="section level3">
<h3 id="nearest-neighbor-calculation">Nearest Neighbor Calculation<a class="anchor" aria-label="anchor" href="#nearest-neighbor-calculation"></a>
</h3>
<p><code>uwot</code> leans heavily on the <a href="https://github.com/spotify/annoy" class="external-link">Annoy</a> library for
approximate nearest neighbor search. As a result, compared to the Python
version of UMAP, <code>uwot</code> has much more limited support for
different distance measurements, and no support for sparse matrix data
input.</p>
<p>However, <code>uwot</code> <em>does</em> let you pass in nearest
neighbor data. So if you have access to other nearest neighbor methods,
you can generate data that can be used with <code>uwot</code>. See the
<a href="https://github.com/jlmelville/uwot#nearest-neighbor-data-format" class="external-link">Nearest
Neighbor Data Format</a> article. Or if you can calculate a distance
matrix for your data, you can pass it in as <code>dist</code>
object.</p>
<p>For larger distance matrices, you can pass in a
<code>sparseMatrix</code> (from the <a href="https://cran.r-project.org/package=Matrix" class="external-link">Matrix</a>
package).</p>
<p>Experience with <a href="https://www.cs.columbia.edu/CAVE/software/softlib/coil-100.php" class="external-link">COIL-100</a>,
which has 49,152 features, suggests that Annoy will <em>definitely</em>
struggle with datasets of this dimensionality. Even 3000 dimensions can
cause problems, although this is not a difficulty specific to Annoy.
Reducing the dimensionality with PCA to an intermediate dimensionality
(e.g. 100) can help. Use e.g. <code>pca = 100</code> to do this. This
can also be slow on platforms without good linear algebra support and
you should assure yourself that 100 principal components won’t be
throwing away excessive amounts of information.</p>
</div>
<div class="section level3">
<h3 id="spectral-initialization">Spectral Initialization<a class="anchor" aria-label="anchor" href="#spectral-initialization"></a>
</h3>
<p>The spectral initialization default for <code>umap</code> (and the
Laplacian Eigenmap initialization, <code>init = "laplacian"</code>) can
sometimes run into problems. If it fails to converge it will fall back
to random initialization, but on occasion I’ve seen it take an extremely
long time (a couple of hours) to converge. Recent changes have hopefully
reduced the chance of this happening, but if initialization is taking
more than a few minutes, I suggest stopping the calculation and using
the scaled PCA (<code>init = "spca"</code>) instead.</p>
</div>
</div>
<div class="section level2">
<h2 id="supporting-libraries">Supporting Libraries<a class="anchor" aria-label="anchor" href="#supporting-libraries"></a>
</h2>
<p>All credit to the following packages which do a lot of the hard
work:</p>
<ul>
<li>Coordinate initialization uses <a href="https://cran.r-project.org/package=RSpectra" class="external-link">RSpectra</a> to do
the eigendecomposition of the normalized Laplacian.</li>
<li>The optional PCA initialization and initial dimensionality reduction
uses <a href="https://cran.r-project.org/package=irlba" class="external-link">irlba</a>.</li>
<li>The smooth k-nearest neighbor distance and stochastic gradient
descent optimization routines are written in C++ (using <a href="https://cran.r-project.org/package=Rcpp" class="external-link">Rcpp</a>, aping the
Python code as closely as possible.</li>
<li>Some of the multi-threading code is based on <a href="https://github.com/RcppCore/RcppParallel" class="external-link">RcppParallel</a>.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by James Melville.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
