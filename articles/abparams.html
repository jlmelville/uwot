<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fine-tuning UMAP Visualizations • uwot</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><script src="../extra.js"></script><meta property="og:title" content="Fine-tuning UMAP Visualizations">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">uwot</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/uwot.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jlmelville/uwot/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fine-tuning UMAP Visualizations</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jlmelville/uwot/blob/master/vignettes/articles/abparams.Rmd" class="external-link"><code>vignettes/articles/abparams.Rmd</code></a></small>
      <div class="d-none name"><code>abparams.Rmd</code></div>
    </div>

    
    
<p>If you look at the UMAP <a href="https://jlmelville.github.io/uwot/articles/umap-examples.html">examples</a>,
it’s clear that the default settings aren’t always appropriate for some
datasets: it’s easy to get results where the clusters are very spaced
out relative to their sizes, which makes viewing your data on a single
static plot quite difficult compared to t-SNE. Fortunately, UMAP’s
output weight function can be adjusted to give different results.</p>
<p>Note that another way to change UMAP’s output is to modify the value
of <code>n_neighbors</code>. This is a more drastic change that directly
modifies the input affinity graph we are trying to find a
low-dimensional approximation to, and it can have a big effect on
run-time, so we won’t consider that here. Changes to the output weight
function are more subtle.</p>
<div class="section level2">
<h2 id="theory">Theory<a class="anchor" aria-label="anchor" href="#theory"></a>
</h2>
<p>The output weight between two points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
are given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>1</mn><mi>/</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mi>a</mi><msubsup><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mn>2</mn><mi>b</mi></mrow></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
w_{ij} = 1 / \left(1 + ad_{ij}^{2b}\right)
</annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">d_{ij}</annotation></semantics></math>
being the Euclidean distance in the embedding between the two points.
Below I drop the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mi>j</mi></mrow><annotation encoding="application/x-tex">ij</annotation></semantics></math>
subscript for clarity’s sake.
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>b</mi><annotation encoding="application/x-tex">b</annotation></semantics></math>
are two hyper-parameters. Usually they are determined by a non-linear
least squares fit based on an exponential decay curve parameterized by
<code>min_dist</code> and <code>spread</code>:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><mo>max</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>d</mi><mo>−</mo><mi>ρ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>/</mi><mi>σ</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
w = \exp\left[-\max \left(0, d - \rho \right) / \sigma \right]
</annotation></semantics></math></p>
<p>where <code>min_dist</code> is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
and <code>spread</code> is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>.
I have used those symbols to make it more obvious that this equation has
the same form as UMAP’s weighting function for its edge weights in the
input space. As a reminder, the presence of the <code>max</code>
operation and shifting the distances by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ρ</mi><annotation encoding="application/x-tex">\rho</annotation></semantics></math>
is to enforce the local connectivity constraint: there is always an edge
weight of 1 between a point and its nearest neighbor.
<code>spread</code> determines the x-value range over which the y-value
decays to zero, and is set to <code>spread</code> multiplied by 3.</p>
<p>Here’s some R code that works through this and then plots the results
using the Python UMAP defaults of <code>spread = 1</code>,
<code>min_dist = 0.1</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spread</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">min_dist</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="co"># define the exponential</span></span>
<span><span class="va">xv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  to <span class="op">=</span> <span class="va">spread</span> <span class="op">*</span> <span class="fl">3</span>,</span>
<span>  length.out <span class="op">=</span> <span class="fl">300</span></span>
<span><span class="op">)</span></span>
<span><span class="va">yv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">xv</span> <span class="op">-</span> <span class="va">min_dist</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">spread</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the a,b curve to the exponential</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a></span><span class="op">(</span><span class="va">yv</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">a</span> <span class="op">*</span> <span class="va">xv</span><span class="op">^</span><span class="op">(</span><span class="fl">2.0</span> <span class="op">*</span> <span class="va">b</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">m</span><span class="op">$</span><span class="fu">getPars</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">[</span><span class="st">"a"</span><span class="op">]</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">params</span><span class="op">[</span><span class="st">"b"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot the results</span></span>
<span><span class="va">title</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"exp curve spread = "</span>,</span>
<span>    <span class="va">spread</span>,</span>
<span>    <span class="st">", min_dist = "</span>,</span>
<span>    <span class="va">min_dist</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">sub</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"UMAP fit (green) a = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">a</span><span class="op">)</span>, <span class="st">" b = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">xv</span>,</span>
<span>  <span class="va">yv</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"d"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"w"</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>  main <span class="op">=</span> <span class="va">title</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="va">sub</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">xv</span>, <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">a</span> <span class="op">*</span> <span class="va">xv</span><span class="op">^</span><span class="op">(</span><span class="fl">2.0</span> <span class="op">*</span> <span class="va">b</span><span class="op">)</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"#1B9E77FF"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="img/abparams/umap_ab_curve.png" alt="UMAP a,b curve"><div class="figcaption">UMAP a,b curve</div>
</div>
<p>As the title indicates, this curve leads to the default parameters of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1.577</mn></mrow><annotation encoding="application/x-tex">a = 1.577</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>0.895</mn></mrow><annotation encoding="application/x-tex">b = 0.895</annotation></semantics></math>.
<code>uwot</code> uses a slightly different default
<code>min_dist = 0.001</code>, which leads to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1.93</mn><mo>,</mo><mi>b</mi><mo>=</mo><mn>0.79</mn></mrow><annotation encoding="application/x-tex">a = 1.93, b = 0.79</annotation></semantics></math>.
I don’t know why I used a different default <code>min_dist</code> –
probably I made a mistake. This is likely to change in a later version
of <code>uwot</code>, but it doesn’t make much of a difference to the
results, fortunately. Setting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>b</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a = 1, b = 1</annotation></semantics></math>
gives the Cauchy distribution used in t-SNE (and the <code>tumap</code>
function in <code>uwot</code>), which corresponds roughly to
<code>spread = 1.12</code> and <code>min_dist = 0.23</code>: putting
those values back into the curve-fitting routine will give you back
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mo>=</mo><mn>0.99</mn></mrow><annotation encoding="application/x-tex">a = 0.99</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mo>=</mo><mn>1.01</mn></mrow><annotation encoding="application/x-tex">b = 1.01</annotation></semantics></math>.
Close enough. Here is the <code>uwot</code> default results in orange
and the Cauchy results in blue overlaid with the UMAP defaults (green,
same as in the previous plot):</p>
<div class="float">
<img src="img/abparams/umap_ab_curve_other.png" alt="Other UMAP a,b curve"><div class="figcaption">Other UMAP a,b curve</div>
</div>
<p>This still leaves open the question of how changing
<code>spread</code> and <code>min_dist</code>, or <code>a</code> and
<code>b</code> affects the output of UMAP. The current version of the <a href="https://umap-learn.readthedocs.io/en/latest/parameters.html" class="external-link">UMAP
docs</a> doesn’t mention <code>spread</code> and treats
<code>min_dist</code> as the only adjustable parameter, which can be
varied between <code>0</code> and very close to <code>1</code>. But in
what follows we’ll take a look at both <code>min_dist</code> and
<code>spread</code>, and use the trusty MNIST digits dataset to
investigate their effect.</p>
</div>
<div class="section level2">
<h2 id="min_dist-and-spread">min_dist and spread<a class="anchor" aria-label="anchor" href="#min_dist-and-spread"></a>
</h2>
<p>Let’s look at <code>min_dist</code> and <code>spread</code> first.
First, I’ll show some results of changing <code>spread</code>, keeping
<code>min_dist = 0.1</code> and then we’ll look at changing
<code>min_dist</code>, while fixing <code>spread = 1</code>. The above
explanation of the exponential curve suggests that allowing
<code>min_dist</code> to exceed the value of <code>spread</code> will
give increasingly odd results.</p>
<div class="section level3">
<h3 id="spread">spread<a class="anchor" aria-label="anchor" href="#spread"></a>
</h3>
<p>In the plots below, the value of <code>spread</code> and
<code>min_dist</code> is given in the title, along with the values of
<code>a</code> and <code>b</code> that they give rise to. The value of
<code>spread</code> increases from 0.1 to 10 as we go from left to right
and top to bottom.</p>
<table class="table">
<colgroup>
<col width="35%">
<col width="31%">
<col width="32%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/abparams/mnist_s0.1d0.1.png" alt="spread = 0.1"></td>
<td align="center"><img src="img/abparams/mnist_s0.5d0.1.png" alt="spread = 0.5"></td>
<td align="center"><img src="img/abparams/mnist_s0.75d0.1.png" alt="spread = 0.75"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/abparams/mnist_s1d0.1.png" alt="spread = 1"></td>
<td align="center"><img src="img/abparams/mnist_s1.5d0.1.png" alt="spread = 1.5"></td>
<td align="center"><img src="img/abparams/mnist_s2d0.1.png" alt="spread = 2"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/abparams/mnist_s3d0.1.png" alt="spread = 3"></td>
<td align="center"><img src="img/abparams/mnist_s5d0.1.png" alt="spread = 5"></td>
<td align="center"><img src="img/abparams/mnist_s10d0.1.png" alt="spread = 10"></td>
</tr>
</tbody>
</table>
<p>The top-left result, with <code>spread = min_dist = 0.1</code> gives
a clear indication that you want <code>spread</code> to be larger than
<code>min_dist</code>. Then, for values of <code>spread</code> between
0.5-3 not much happens. As <code>spread</code> gets to 5 and above, the
clusters start to overlap each other.</p>
<p>Here’s a table summarizing how <code>a</code> and <code>b</code>
change as <code>spread</code> is varied.</p>
<table class="table">
<thead><tr class="header">
<th>spread</th>
<th>min_dist</th>
<th>a</th>
<th>b</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0.1</td>
<td>0.1</td>
<td>830</td>
<td>1.93</td>
</tr>
<tr class="even">
<td>0.5</td>
<td>0.1</td>
<td>5.07</td>
<td>1.00</td>
</tr>
<tr class="odd">
<td>0.75</td>
<td>0.1</td>
<td>2.51</td>
<td>0.93</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.1</td>
<td>1.58</td>
<td>0.90</td>
</tr>
<tr class="odd">
<td>1.5</td>
<td>0.1</td>
<td>0.84</td>
<td>0.86</td>
</tr>
<tr class="even">
<td>2</td>
<td>0.1</td>
<td>0.54</td>
<td>0.84</td>
</tr>
<tr class="odd">
<td>3</td>
<td>0.1</td>
<td>0.30</td>
<td>0.82</td>
</tr>
<tr class="even">
<td>5</td>
<td>0.1</td>
<td>0.14</td>
<td>0.81</td>
</tr>
<tr class="odd">
<td>10</td>
<td>0.1</td>
<td>0.05</td>
<td>0.80</td>
</tr>
</tbody>
</table>
<p>For low values of <code>spread</code>, <code>a</code> starts getting
very large.</p>
<p>What about <code>min_dist</code>? Below, <code>min_dist</code>
increases from 0.0001 to 2, with <code>spread = 1</code>, so I suspect
the highest of these values will also show some eccentric results.</p>
</div>
<div class="section level3">
<h3 id="min_dist">min_dist<a class="anchor" aria-label="anchor" href="#min_dist"></a>
</h3>
<table class="table">
<colgroup>
<col width="35%">
<col width="31%">
<col width="32%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/abparams/mnist_s1d0.0001.png" alt="min_dist = 0.0001"></td>
<td align="center"><img src="img/abparams/mnist_s1d0.001.png" alt="min_dist = 0.001"></td>
<td align="center"><img src="img/abparams/mnist_s1d0.01.png" alt="min_dist = 0.01"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/abparams/mnist_s1d0.05.png" alt="min_dist = 0.05"></td>
<td align="center"><img src="img/abparams/mnist_s1d0.1.png" alt="min_dist = 0.1"></td>
<td align="center"><img src="img/abparams/mnist_s1d0.5.png" alt="min_dist = 0.5"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/abparams/mnist_s1d1.png" alt="min_dist = 1"></td>
<td align="center"><img src="img/abparams/mnist_s1d1.5.png" alt="min_dist = 1.5"></td>
<td align="center"><img src="img/abparams/mnist_s1d2.png" alt="min_dist = 2"></td>
</tr>
</tbody>
</table>
<p>Again, there is a range of <code>min_dist</code> values, from 0.0001
to 0.1 where not much happens to the plot. Above this value, the
clusters begin to expand. The final shapes are very diffuse. The table
below shows how <code>a</code> and <code>b</code> change as
<code>min_dist</code> increases.</p>
<table class="table">
<thead><tr class="header">
<th>spread</th>
<th>min_dist</th>
<th>a</th>
<th>b</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>0.0001</td>
<td>1.932</td>
<td>0.791</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.001</td>
<td>1.929</td>
<td>0.792</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0.01</td>
<td>1.90</td>
<td>0.80</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.05</td>
<td>1.75</td>
<td>0.84</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0.1</td>
<td>1.58</td>
<td>0.90</td>
</tr>
<tr class="even">
<td>1</td>
<td>0.5</td>
<td>0.58</td>
<td>1.33</td>
</tr>
<tr class="odd">
<td>1</td>
<td>1</td>
<td>0.12</td>
<td>1.93</td>
</tr>
<tr class="even">
<td>1</td>
<td>1.5</td>
<td>0.013</td>
<td>2.67</td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>0.0004</td>
<td>3.89</td>
</tr>
</tbody>
</table>
<p>For value of <code>min_dist</code> larger than 0.5, values of
<code>a</code> drop quickly while <code>b</code> increases rapidly.</p>
<p>In terms of the differences between <code>spread</code> and
<code>min_dist</code>, <code>min_dist</code> seems to more obviously
increase the size of the clusters, whereas increasing
<code>spread</code> keeps the shape and boundary of the clusters a bit
better. <code>spread</code> can therefore be used to control the
inter-cluster distances to some extent, where as <code>min_dist</code>
controls the size of the clusters.</p>
</div>
</div>
<div class="section level2">
<h2 id="a-and-b">a and b<a class="anchor" aria-label="anchor" href="#a-and-b"></a>
</h2>
<p>Rather than change <code>spread</code> and <code>min_dist</code>, we
can supply values of <code>a</code> and <code>b</code> directly. Perhaps
these can also be interpreted. Again, we’ll look at changing each value
separately, leaving the other value at the UMAP defaults
(<code>a = 1.58</code> and <code>b = 0.90</code>). I used the range of
values of <code>a</code> and <code>b</code> that resulted from changing
<code>min_dist</code> and <code>spread</code> in the previous section’s
results to set the range of values I look at below.</p>
<p><a href="https://www.jmlr.org/papers/v22/20-1061.html" class="external-link">Wang and
co-workers</a> recommend that <code>b &gt; 0.5</code> to be a good loss
function for dimensionality reduction (see Proposition 1 and 2 in their
PaCMAP paper).</p>
<div class="section level3">
<h3 id="a">a<a class="anchor" aria-label="anchor" href="#a"></a>
</h3>
<p><code>a</code> seemed to have a wider range of values than
<code>b</code>, so I looked at values between <code>a = 0.0001</code>
and <code>a = 100</code>.</p>
<table class="table">
<colgroup>
<col width="35%">
<col width="31%">
<col width="32%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/abparams/mnist_a0.0001b0.9.png" alt="a = 0.0001"></td>
<td align="center"><img src="img/abparams/mnist_a0.001b0.9.png" alt="a = 0.001"></td>
<td align="center"><img src="img/abparams/mnist_a0.01b0.9.png" alt="a = 0.01"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/abparams/mnist_a0.1b0.9.png" alt="a = 0.1"></td>
<td align="center"><img src="img/abparams/mnist_a1b0.9.png" alt="a = 1"></td>
<td align="center"><img src="img/abparams/mnist_a2b0.9.png" alt="a = 2"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/abparams/mnist_a10b0.9.png" alt="a = 10"></td>
<td align="center"><img src="img/abparams/mnist_a50b0.9.png" alt="a = 50"></td>
<td align="center"><img src="img/abparams/mnist_a100b0.9.png" alt="a = 100"></td>
</tr>
</tbody>
</table>
<p><code>a</code> seems to control the spread of the clusters for most
of its range. Low values of <code>a</code> certainly result in a diffuse
round cloud. Above <code>a = 10</code>, I suspect we are running into
numerical issues with taking a large power of a small positive value.
Values between 0.1 and 10 seem reasonable, with higher values leading to
smaller clusters.</p>
</div>
<div class="section level3">
<h3 id="b">b<a class="anchor" aria-label="anchor" href="#b"></a>
</h3>
<p><code>b</code> definitely seems to have a smaller range of useful
values compared to <code>a</code>, so I looked at values between
<code>b = 0.1</code> to <code>b = 2.5</code>.</p>
<table class="table">
<colgroup>
<col width="35%">
<col width="31%">
<col width="32%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/abparams/mnist_a1.58b0.1.png" alt="b = 0.1"></td>
<td align="center"><img src="img/abparams/mnist_a1.58b0.25.png" alt="b = 0.25"></td>
<td align="center"><img src="img/abparams/mnist_a1.58b0.5.png" alt="b = 0.5"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/abparams/mnist_a1.58b0.75.png" alt="b = 0.75"></td>
<td align="center"><img src="img/abparams/mnist_a1.58b1.png" alt="b = 1"></td>
<td align="center"><img src="img/abparams/mnist_a1.58b1.25.png" alt="b = 1.25"></td>
</tr>
<tr class="odd">
<td align="center"><img src="img/abparams/mnist_a1.58b1.5.png" alt="b = 1.5"></td>
<td align="center"><img src="img/abparams/mnist_a1.58b2.png" alt="b = 2"></td>
<td align="center"><img src="img/abparams/mnist_a1.58b2.5.png" alt="b = 2.5"></td>
</tr>
</tbody>
</table>
<p><code>b</code> seems to work like the heavy-tail parameter sometimes
used in <a href="https://arxiv.org/abs/1902.05804" class="external-link">t-SNE</a>: low values
increase the distances between the clusters, relative to their size, but
also reveal sub-clusters that appear to be one structure in the other
plots. At high values, the space between clusters is reduced, but you
can still see borders between the clusters, unlike what happens with low
<code>a</code>.</p>
<p>I don’t see a big difference between using <code>a</code> and
<code>b</code> directly, or sticking with <code>min_dist</code> and
<code>spread</code> I prefer <code>a</code> and <code>b</code> myself,
as it reminds me more of the approach used in <a href="https://people.eecs.berkeley.edu/~pabbeel/papers/2015-ICML-absne.pdf" class="external-link">ABSNE
(PDF)</a>, although I don’t claim there is any equivalence between the
<code>a</code> and <code>b</code> parameters in UMAP and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
parameters in that work.</p>
</div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>MNIST is useful for seeing the effect of changing <code>a</code> and
<code>b</code>, but it can be visualized well with the default
parameters. So here are two examples which show that we can improve on
the default visualizations, by using our knowledge of what
<code>a</code> and <code>b</code> roughly represent in terms of cluster
size and separation.</p>
<div class="section level3">
<h3 id="example-1-tasic2018">Example 1: tasic2018<a class="anchor" aria-label="anchor" href="#example-1-tasic2018"></a>
</h3>
<p>The transcriptomics dataset tasic2018 is a good example where the
default UMAP parameters are sub-optimal. Below is the default UMAP
result in the top left image, and then a series of results based on me
fiddling with <code>a</code> and <code>b</code> in response to it. I
eventually fumble my way to a setting with a lower <code>a</code> and a
higher <code>b</code> that provides a better visualization (in my
opinion), which you can see in the lower right.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/abparams/tasic2018_a1.58b0.9.png" alt="a = 1.58 b = 0.9"></td>
<td align="center"><img src="img/abparams/tasic2018_a1b0.9.png" alt="a = 1 b = 0.9"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/abparams/tasic2018_a1b1.5.png" alt="a = 1 b = 1.5"></td>
<td align="center"><img src="img/abparams/tasic2018_a0.5b1.5.png" alt="a = 0.5 b = 1.5"></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="example-2-coil-20">Example 2: COIL-20<a class="anchor" aria-label="anchor" href="#example-2-coil-20"></a>
</h3>
<p>And here’s another example where arguably the default UMAP results
spread the clusters out a bit too much. Here are three alternatives
based on controlling <code>a</code> and <code>b</code>.</p>
<table class="table">
<colgroup>
<col width="51%">
<col width="48%">
</colgroup>
<tbody>
<tr class="odd">
<td align="center"><img src="img/abparams/coil20_a1.58b0.9.png" alt="a = 1.58 b = 0.9"></td>
<td align="center"><img src="img/abparams/coil20_a0.1b0.9.png" alt="a = 0.1 b = 0.9"></td>
</tr>
<tr class="even">
<td align="center"><img src="img/abparams/coil20_a0.5b0.9.png" alt="a = 0.5 b = 0.9"></td>
<td align="center"><img src="img/abparams/coil20_a0.5b1.1.png" alt="a = 0.5 b = 1.1"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="my-recommendation">My recommendation<a class="anchor" aria-label="anchor" href="#my-recommendation"></a>
</h2>
<p>Hopefully this is enough to convince you that the embedding
parameters can be profitably twiddled with in more than a random way to
give visualizations that improve over the default settings.</p>
<p>Of <code>min_dist</code> and <code>spread</code>, modifying
<code>min_dist</code> between 0 and 1, as suggested by the UMAP docs
seems to be most fruitful of the parameters to meddle with.</p>
<p>I personally prefer to use <code>a</code> and <code>b</code>
directly. To find good values for <code>a</code> and <code>b</code>, you
can start with them at <code>a = 1 and b = 1</code>, which gives a
t-SNE-like output function, and you can use the <code>tumap</code>
function to generate the initial plot much faster. I also recommend
doing any PCA dimensionality reduction outside of <code>uwot</code> and
using <code>ret_nn = TRUE</code> for the first plot, so you can re-use
the nearest neighbors data in subsequent runs of <code>umap</code>. This
is a substantial speed up and makes repeating runs with different values
of <code>a</code> and <code>b</code> a lot more tolerable.</p>
<p>Here’s an example workflow:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># PCA to 50 dimensions first</span></span>
<span><span class="va">mnist_pca</span> <span class="op">&lt;-</span> <span class="fu">irlba</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/irlba/man/prcomp_irlba.html" class="external-link">prcomp_irlba</a></span><span class="op">(</span><span class="va">mnist</span>, n <span class="op">=</span> <span class="fl">50</span>, retx <span class="op">=</span> <span class="cn">TRUE</span>, center <span class="op">=</span> <span class="va">center</span>,</span>
<span>                             scale. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">x</span></span>
<span></span>
<span><span class="co"># t-UMAP is equivalent to a = 1, b = 1</span></span>
<span><span class="co"># remember to get the nearest neighbor data back too</span></span>
<span><span class="va">mnist_a1b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tumap.html">tumap</a></span><span class="op">(</span><span class="va">mnist_pca</span>, ret_nn <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find a</span></span>
<span><span class="va">mnist_a1.5b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist_pca</span>, nn_method <span class="op">=</span> <span class="va">mnist_a1b1</span><span class="op">$</span><span class="va">nn</span>, a <span class="op">=</span> <span class="fl">1.5</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mnist_a0.5b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist_pca</span>, nn_method <span class="op">=</span> <span class="va">mnist_a1b1</span><span class="op">$</span><span class="va">nn</span>, a <span class="op">=</span> <span class="fl">0.5</span>, b <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># find b based on whichever value of a you prefer</span></span>
<span><span class="va">mnist_a0.5b1.2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/umap.html">umap</a></span><span class="op">(</span><span class="va">mnist_pca</span>, nn_method <span class="op">=</span> <span class="va">mnist_a1b1</span><span class="op">$</span><span class="va">nn</span>, a <span class="op">=</span> <span class="fl">0.5</span>, b <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by James Melville.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
